(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"B/nE":function(t,e){t.exports='<bb-modal id="close-without-saving-modal"\n          class="notification"\n          modal-title-key="components.directives.close-without-saving-modal.title"\n          analytics-id-tag-prefix="components.directives.closeWithoutSavingModal">\n  <div name="modal-contents">\n    <p bb-translate>components.directives.close-without-saving-modal.instructions</p>\n  </div>\n  \x3c!-- htmlhint:analytics-id:disable --\x3e\n  <button name="modal-footer-button-primary"\n          class="button js-primary-button"\n          ng-click="$parent.$close()"\n          bb-translate\n          analytics-id="components.directives.closeWithoutSavingModal.close.button">\n    global.close\n  </button>\n  <button name="modal-footer-button-secondary"\n          class="button button--secondary js-secondary-button"\n          ng-click="$parent.$dismiss()"\n          bb-translate\n          analytics-id="components.directives.closeWithoutSavingModal.cancel.button">\n    global.cancel\n  </button>\n  \x3c!-- htmlhint:analytics-id:enable --\x3e\n</bb-modal>\n'},MUzn:function(t,e,s){"use strict";s.d(e,"c",(function(){return A})),s.d(e,"a",(function(){return O})),s.d(e,"b",(function(){return w}));var i=s("D57K"),n=s("9zo4"),o=s("43zP"),a=s("jhBu"),r=s("0JpG"),c=s("w9Zy"),h=s("nYZ0"),l=s("Qbdf"),d=s("NxQJ"),u=s("pjml"),b=s("g66W"),C=s("TnpK"),m=s("W6wm"),p=s("B/nE"),v=s("36CG"),g=s("zGdY"),S=s("nmzr"),$=s("aHpC"),f=s("IbyE"),_=s("/5AG"),P=s("AuQm");const A="ultra.course.contentBase.controller";let O=class{constructor(t,e,s,i,n,a,r,c,h,l,b,C,m,p,v,g,S){this.$injector=t,this.$modal=e,this.$q=s,this.$ngRedux=i,this.$rootScope=n,this.$scope=a,this.$stateParams=r,this._accessibility=c,this._bbLocalize=h,this._bbOffcanvas=l,this._content=b,this.contextCourse=C,this._CourseModel=m,this._ultraState=p,this.currentContent=v,this.entitlementService=g,this.loadQueryParams=S,this.defaultTitle=this._bbLocalize.translateSync({locale:this._bbLocalize.getLocale(this.$scope),key:"course.content.contentTitlePlaceholder"}),this.defaultDescription=this._bbLocalize.translateSync({locale:this._bbLocalize.getLocale(this.$scope),key:"course.content.contentDescriptionPlaceholder"}),this.waitingForCreate=!1,this.showDeleteButton=!1,this.titlePopulated=!1,this.showDesc=!1,this.ignoreBlur=!1,this.isFromCourseOutline=!1,this.isFromDiscussion=!1,this.confirmCancellation=!1,this.deleting=!1,this.conditionalReleaseHasUpdated=!1,this.canViewProgress=()=>{var t;return!!(null===(t=this.courseProgressConfiguration)||void 0===t?void 0:t.progressTrackingEnabled)&&this.entitlementService.isEntitled(_.CourseProgressEntitlements.ViewProgressInformation)},a.contentCreateItem=this,C&&C.courseId?this.courseId=C.courseId:p.nextParams&&(this.courseId=p.nextParams.courseId),this.isFromGradebook=!1,this.currentCourse=m.$new(this.courseId),this.autoSaveState=o.a.NoChanges,this.setRouterStateHelperProperties(),this.setPanelLockDownAsNeeded(),this.registerRouterStateChangeEventHandlers(),this.registerAutoSaveEventsAndHandlers(),this.connectToRedux(),this.conversationService=this.$injector.instantiate(d.a,{currentCourse:this.currentCourse,coreContent:this.baseContent}),this.isFromDiscussion?this.workingRootNode=this._content.findRootNode(this.currentCourse,u.p.ContentRootNode.INTERACTIVE):this.workingRootNode=this._content.findRootNode(this.currentCourse,u.p.ContentRootNode.ROOT),this.getBasicContentPromise=this.getBasicContent(),this.$scope.$on("refresh-conditional-release-rules",(t,e)=>{this.conditionalReleaseHasUpdated=!0,this.$scope.content.id===e.id&&(this.newContent=e)})}set newContent(t){this.baseContent=this.conversationService.coreContent=t}get newContent(){return this.baseContent}connectToRedux(){const t=this.$ngRedux.connect(t=>({courseProgressConfiguration:f.select.courseProgress.getCourseProgressConfiguration(t,this.courseId)}),t=>({loadCourseProgressConfiguration:e=>t(f.actions.courseProgress.loadCourseProgressConfiguration({courseId:e}))}))(this);this.$scope.$on("$destroy",()=>t())}setRouterStateHelperProperties(){this.isCreateState=this._ultraState.includes("**.create.**")&&!this.$stateParams.id||this._ultraState.includes("**.assessment.**")&&this.$stateParams.isCreateState,this.isEditState=this._ultraState.includes("**.edit.**")||this._ultraState.includes("**.assessment.**")&&!this.$stateParams.isCreateState,this._ultraState.includes("**course.outline.**")?this.previousState="course.outline":this.previousState=this.$scope.previousState,this.isFromCourseOutline=this._ultraState.includes("**.outline.**"),this.isFromDiscussion=this._ultraState.includes("**.discussion.**")||this._ultraState.includes("**.engagement.**"),this.isFromGradebook=this._ultraState.includes("**.grades.**"),this.isCreateAssignment=this._ultraState.includes("**.assignment-create.**"),this.isCreateDiscussion=this.isCreateState&&this.isFromDiscussion,this.isEditAssignment=this._ultraState.includes("**.assignment.**"),this.isAssessment=this._ultraState.includes("**.assessment.**"),this.isDocument=this._ultraState.includes("**.document.**"),this.isFromCourseOutline?(this.previousState="course.outline",this.contextArea=m.a.CourseOutline):this.isFromDiscussion?(this.previousState="course.engagement",this.contextArea=m.a.Discussions):this.previousState=this.$scope.previousState}registerAutoSaveEventsAndHandlers(){this.$scope.$on("bb-autosave-form",(t,e,s)=>{switch(this.$scope.$broadcast("bb-save-button",e,s),e){case P.AutoSaveMessage.Change:this.autoSaveState=o.a.NotSaved;break;case P.AutoSaveMessage.Saving:this.autoSaveState=o.a.Saving;break;case P.AutoSaveMessage.Saved:this.autoSaveState=o.a.Saved;break;case P.AutoSaveMessage.SaveFailure:case P.AutoSaveMessage.ValidationFailure:}})}getBasicContent(){const t=this._ultraState.params;if(this.isFromGradebook||this.isEditAssignment){if(void 0===t.id){const e=this.$scope.$parent.gradebookItem;e&&(t.id=e.column.contentId)}}else this.isAssessment&&t.contentId!==u.p.CREATE_CONTENT_ID&&(t.id=t.contentId);return this._content.getOrMakeContentInContentTree(this.workingRootNode,this.courseId,t.id,t.parentId,t.positionBefore,t.positionAfter).then(t=>(this.newContent=t.content,this.currentContent.setCurrentContent(this.newContent),this.baseContent.attachedForumLink&&(this.baseContent.ui.hasConversationAttached=!0),this.titlePopulated=null!=this.baseContent.id,this.isEditState&&(this.initiallyLoadedContent=this.baseContent.$snapshot()),(this.isCreateState||this.isCreateAssignment)&&null==this.baseContent.id&&(this.baseContent.isAvailable=!1,this.baseContent.isPartiallyVisible=!1,this.baseContent.visibility=g.ContentVisibility.Hidden,this.baseContent.contentHandler=u.p.ContentHandler.Unknown,this.baseContent.ui.hasConversationAttached=!1,this.baseContent.permissions={edit:!0}),t))}setPanelLockDownAsNeeded(){this.isCreateState||this.isEditState?this.confirmCancellation=!0:this.isCreateAssignment&&(this.confirmCancellation=!0)}get title(){if(this.titlePopulated)return this.baseContent.title}set title(t){t?(this.baseContent.title=t,this.titlePopulated=!0):(this.baseContent.title=this.defaultTitle,this.titlePopulated=!1)}get body(){if(this.baseContent)return this.baseContent.description}set body(t){this.baseContent&&(this.baseContent.description=t)}_updateOutlineItemInfo(){this.autoSaveState=o.a.NotSaved}gotoPreviousState(){this.previousState===this._ultraState.getBaseState()?this._ultraState.goCurrentBasePage():this._ultraState.goPeekState(this.previousState)}saveClicked(){this.$q.when(this.persist()).then(t=>{t&&(this.confirmCancellation=!1,this.gotoPreviousState())})}persist(){return this._persist()}_persist(){if(this.validate()){if(this.beforePersistCreateOrUpdate(),null!=this.baseContent.id||this.waitingForCreate)this.baseContent.$patch().$then(()=>{this.afterPersistUpdate()});else{this.waitingForCreate=!0;const t=()=>{this.waitingForCreate=!1,this.baseContent.$off("after-save",t)};this.baseContent.$on("after-save",t),this.baseContent.$save().$then(()=>{this.afterPersistCreate()})}this.baseContent.$then(()=>{this.afterPersistCreateOrUpdate()})}return this.baseContent.$asPromise()}beforePersistCreateOrUpdate(){this.$scope.$broadcast("bb-autosave-interrupt-timer"),this.$scope.$emit("bb-autosave-form",P.AutoSaveMessage.Saving)}afterPersistCreate(){this.setUrlToPersisted()}afterPersistUpdate(){}updateVisibility(t){return this.$rootScope.$broadcast("content-update",t),t.$fetch().$asPromise().then(t=>t.hasCourseLinks().then(e=>{if(e)return t.getSoftLinks().$asPromise().then(e=>{if(e.length)return this.$q.all(e.map(e=>this._CourseModel.$new(t.courseId).contents.$new(e.courseContent).$fetch().$asPromise().then(t=>{this.$rootScope.$broadcast("content-update",t,!1)})))})}))}afterPersistCreateOrUpdate(){this.$scope.$emit("bb-autosave-form",P.AutoSaveMessage.Saved)}setUrlToPersisted(){(this.isCreateState||this.isCreateAssignment)&&this.baseContent&&this.baseContent.id&&this._ultraState.go(this._ultraState.current.name,{id:this.baseContent.id,parentId:this.courseId,position:void 0,positionBefore:"start",positionAfter:void 0,gradeitemView:"details"},{notify:!1,location:"replace"}).then(()=>this.$rootScope.$broadcast("bb-content-created"))}cancelClicked(){this.cancel(),this.confirmCancellation=!1,this.gotoPreviousState()}cancel(){this.isEditState?this.conditionalReleaseHasUpdated||this.revert():(this.isCreateState||this.isCreateAssignment&&!this.baseContent.id)&&this.delete({allowDeleteConfirmation:!1})}revert(){this.initiallyLoadedContent&&(this.baseContent.$revert(this.initiallyLoadedContent),this.baseContent.$patch())}addedAndRemovedConditionalRelease(){var t;this.conditionalReleaseHasUpdated&&(null===(t=this.initiallyLoadedContent)||void 0===t?void 0:t.adaptiveReleaseRules)&&(this.baseContent.$revert(this.initiallyLoadedContent),this.persist())}reapplyConditionalRelease(){if(this.initiallyLoadedContent.adaptiveReleaseRules&&!this.newContent.adaptiveReleaseRules.startDate){const t=["isAvailable","adaptiveReleaseRules","isPartiallyVisible"],e="Rule 1",s=()=>this.baseContent.withParams({fields:"id"}).$save(t).$asPromise(),i={};return i.title=e,i.contentId=this.baseContent.id,i.criteria=this.initiallyLoadedContent.adaptiveReleaseRules.rules[0].criteria,i.criteria.forEach(t=>{t.id&&delete t.id}),s().then(()=>this.baseContent.conditionalReleaseAsync("POST",[i]).$asPromise())}}deleteClicked(){this.delete(),this.confirmCancellation=!1,this.deleting=!0,this.gotoPreviousState()}delete(t){t&&!t.allowDeleteConfirmation&&delete this.baseContent.ui.deleteConfirmationKey,this.$rootScope.$broadcast("deleteContent",this.baseContent)}setFocusForPanelClose(t){if(!t)return;const e=`[data-content-id=${t}] .content-title`,s=`[data-content-id=${t}] .ax-focusable-title`;this._accessibility.setFocusOverrideOnPanel(`${e}, ${s}`,".js-content-outline, .js-engagement-outline")}registerRouterStateChangeEventHandlers(){window.onbeforeunload=()=>{if(this.confirmCancellation)return this._bbLocalize.translateSync({locale:this._bbLocalize.getLocale(this.$scope),key:"course.content.close-without-saving-modal.title"})},this.$scope.$on("$destroy",(function(){window.onbeforeunload=void 0})),this.$scope.$on("$stateChangeStart",this.onStateChangeStart.bind(this))}onStateChangeStart(t,e,s,i,n){(this.isLeavingContentCreateOrEditPanel(i,e)||this.isLeavingContentChooserPanel(i,e))&&this.onPanelClose(t,e,i)}onPanelClose(t,e,s){this.deleting?this.deleting=!1:this.confirmCancellation?this.autoSaveState!==o.a.NoChanges?this.confirmAbandonChanges(t):this.cancelClicked():this.baseContent&&this.setFocusForPanelClose(this.baseContent.id)}confirmAbandonChanges(t){t.preventDefault(),this.$modal.open({template:p,resolve:{translations:[r.serviceName,t=>t.loadBundle("components/directives/close-without-saving-modal")]}}).result.then(()=>{this.cancelClicked()},()=>{})}isLeavingContentCreateOrEditPanel(t,e){return(t.name.indexOf(".content-manage.create.")>=0||t.name.indexOf(".gradebook-item.assignment-create")>=0||b.d(t.name,S.GradeRoutes.GRADEBOOK_ITEM_ASSESSMENT))&&-1===e.name.indexOf(".content-manage.create.")&&-1===e.name.indexOf(".gradebook-item.assignment-create")&&-1===e.name.indexOf(S.GradeRoutes.GRADEBOOK_ITEM_ASSESSMENT)}isLeavingContentChooserPanel(t,e){return t.name.indexOf(".content-manage.")>=0&&-1===e.name.indexOf("content-manage.")&&-1===e.name.indexOf(".gradebook-item.assignment-create")}forceSaveOnBlur(){this.autoSaveState===o.a.NotSaved&&this.validate()&&!this.ignoreBlur&&(this.$scope.$broadcast("bb-autosave-interrupt-timer"),this.$scope.$broadcast("bb-save-button",P.AutoSaveMessage.Saving),this.persist().then(t=>{this.$scope.$broadcast("bb-save-button",P.AutoSaveMessage.Saved)},t=>{this.$scope.$broadcast("bb-save-button",P.AutoSaveMessage.SaveFailure)}))}disableBlur(){this.$scope.$broadcast("bb-autosave-interrupt-timer"),this.ignoreBlur=!0}_validate(){return this.titlePopulated}validate(){return this._validate()}canEdit(){return!(!this.newContent||!this.newContent.canEdit())||void 0}get isOrganization(){return this.contextCourse.course.isOrganization}};O=Object(i.__decorate)([Object(i.__param)(0,Object($.b)("$injector")),Object(i.__param)(1,Object($.b)("$modal")),Object(i.__param)(2,Object($.b)("$q")),Object(i.__param)(3,Object($.b)("$ngRedux")),Object(i.__param)(4,Object($.b)("$rootScope")),Object(i.__param)(5,Object($.b)("$scope")),Object(i.__param)(6,Object($.b)("$stateParams")),Object(i.__param)(7,Object($.b)(n.c)),Object(i.__param)(8,Object($.b)(r.serviceName)),Object(i.__param)(9,Object($.b)(c.e)),Object(i.__param)(10,Object($.b)(h.f)),Object(i.__param)(11,Object($.b)(l.e)),Object(i.__param)(12,Object($.b)(u.m.serviceName)),Object(i.__param)(13,Object($.b)(C.d)),Object(i.__param)(14,Object($.b)(v.g)),Object(i.__param)(15,Object($.b)(a.b))],O);class w extends O{}},NxQJ:function(t,e,s){"use strict";s.d(e,"c",(function(){return r})),s.d(e,"a",(function(){return c})),s.d(e,"b",(function(){return h}));var i=s("Llzl"),n=s("pjml"),o=s("Sa5G"),a=s("fYJU");const r="ultra.components.services.courseContent.conversation";class c{constructor(t,e,s,i,n){this.currentCourse=t,this.coreContent=e,this.$q=s,this.$rootScope=i,this.contextUser=n}checkAndAddAllConversations(){const t=this.$q.defer();return this.coreContent.ui.hasConversationAttached&&!this.coreContent.attachedForumLink?(this.conversationContent=this.coreContent,this.isCourseAvailable=this.coreContent.isAvailable,this.conversationContent.forumAttacherAction=n.p.ForumAttacherAction.ADD.toString().toUpperCase(),this.conversationContent.withParams({fields:"attachedForumLink"}).$patch().$then(e=>{this.currentCourse.contents.$find(e.attachedForumLink["resource/x-bb-courselink"].courseContent).$asPromise().then(t=>this.createNewDiscussion(t)),t.resolve()})):t.resolve(),t.promise}markAllConversationsForRemoval(){this.coreContent.ui.hasConversationAttached||this.coreContent.allowConversations||!this.coreContent.attachedForumLink||(this.coreContent.attachedForumLink=null,this.coreContent.forumAttacherAction=n.p.ForumAttacherAction.DELETE.toString().toUpperCase())}createNewDiscussion(t){const e=t.contentDetail[o.f.Discussion.handle].id,s=this.currentCourse.forums.$find(e);s.messages.$fetch().$then(i=>{if(i){const t=i.find(t=>!t.groupId);if(t)return t}return s.messages.$build({forumId:e,courseId:t.courseId,parentId:"{unset id}",userId:this.contextUser.userId,postedName:this.contextUser.userModel.userName,body:{rawText:"",displayText:""},isDeleted:!1,isAvailable:!0}).$save().$asPromise()}).$then(()=>this.initializeDiscussionStatus())}initializeDiscussionStatus(){this.coreContent&&(this.coreContent.ui.hasConversationAttached=!0,this.coreContent.attachedForumLink&&this.currentCourse.contents.$find(this.coreContent.attachedForumLink["resource/x-bb-courselink"].courseContent).$then(t=>{const e=t.contentDetail[o.f.Discussion.handle].id;this.currentCourse.forums.$find(e).$then(t=>{t.messages.$fetch().$then(t=>{const e=t[0];e&&(e.ui.replyText="")})})})),this.conversationContent.isAvailable=this.isCourseAvailable,this.conversationContent.$patch().$then(t=>{this.coreContent=t})}static showConversations(t){return!(!t||!t.id)&&(void 0===(t.ui&&t.ui.hasConversationAttached)&&(t.ui.hasConversationAttached=null!=t.attachedForumLink),t.ui.hasConversationAttached)}}c.$inject=["currentCourse","coreContent","$q","$rootScope",a.b];class h extends c{}i.module(r,[n.N,a.a]).service("courseContentConversation",c)}}]);