(window.webpackJsonp=window.webpackJsonp||[]).push([[123],{"5cjn":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("D57K"),o=i("aHpC");const s="ultra.components.directives.bbInView";let l=class{constructor(e){this.$parse=e,this.restrict="A"}link(e,t,i){const n=new IntersectionObserver(o=>{o[0].intersectionRatio<=0||(n.unobserve(t[0]),this.$parse(i.bbInView)(e))},{threshold:1});n.observe(t[0]),e.$on("$destroy",()=>{n.unobserve(t[0])})}};l=Object(n.__decorate)([Object(n.__param)(0,Object(o.b)("$parse"))],l),angular.module(s,[]).directive("bbInView",["$injector",e=>e.instantiate(l)])},"7scS":function(e,t){e.exports='<div class="file-container-panel" ng-class="{\'last-item\': $last}" bb-content-item-mouseover can-create="canEdit()" bb-load-bundle="components/directives/file-viewer">\n  <div class="file-container"\n       ng-class="[{\'inline-file hover-menu-container\' : fileViewer.displayAsCompactCard}, fileViewer.offCanvasButtonCountClass]"\n       file-name="{{file.linkName}}">\n    <div class="file-meta-container">\n      \x3c!-- add complete class to this element to switch to file-type icon --\x3e\n      <div\n        ng-if="!fileViewer.displayAsCompactCard"\n        analytics-id="components.directives.fileViewer.previewFile.card"\n        class="file-meta complete prevent-fade"\n        ng-class="{\'file-meta-clickable\': fileViewer.showViewInlineButton}"\n        ng-click="fileViewer.showViewInlineButton && fileViewer.toggleFileView(blockId())"\n        bb-translate-attrs="{\'title\': fileViewer.showViewInlineButton && (fileViewer.canRenderFileBlockPreview() ? \'components.directives.file-viewer.hideFile\' : \'components.directives.file-viewer.viewFile\')}"\n        translate-attrs-values="{fileName: file.ui.safeAltText}"\n      >\n        <bb-ally-content-ref\n          ng-if="fileViewer.canShowAlly"\n          content-id="{{::fileViewer.allyContentRefId}}"\n          file-id="{{::fileViewer.xythosId}}"\n          file-preview-url="{{::file.downloadUrl}}"\n        ></bb-ally-content-ref>\n        <div class="element-image {{file.ui.iconClass}}"></div>\n        <div class="progress-circle" ng-class="progressIndicator.getStateClass()"> \x3c!-- Need to add these classes: ng-class="{\'success-state\' : true, \'error-state\' : false}" --\x3e\n          \x3c!-- @TODO: text for aria-valuetext --\x3e\n          <svg class="progress-circle-svg" viewBox="-10 -10 220 220" role="progressbar" aria-valuetext="" aria-valuenow="{{progress}}" aria-valuemin="0" aria-valuemax="100">\n            <path class="back" ng-attr-d="{{\'M0,100 a100,100 0 1 0 200,0 a100,100 0 1 0 -200,0\'}}" fill="transparent" />\n            <path class="bar" ng-attr-d="{{\'m100,0a100,100 0 0 1 0,200a100,100 0 0 1 0,-200\'}}" fill="transparent" stroke-dasharray="629" stroke-dashoffset="629" />\n          </svg>\n          <i class="progress-icon file-error-icon icon-exclamation" ng-if="state === \'error\'"></i>\n          <span class="progress-value" ng-if="state === \'loading\'" bb-translate translate-values="{percentage: progress}">global.percent</span>\n        </div>\n        <p class="no-longtext">\n          <ng-switch on="fileViewer.showViewInlineButton">\n              <button\n                ng-switch-when="true"\n                analytics-id="components.directives.fileViewer.filename.button"\n                bb-translate-attrs="{\'aria-label\': fileViewer.canRenderFileBlockPreview() ? \'components.directives.file-viewer.aria.hideFile\' : \'components.directives.file-viewer.aria.viewFile\', \'title\':fileViewer.canRenderFileBlockPreview() ? \'components.directives.file-viewer.hideFile\' : \'components.directives.file-viewer.viewFile\'}"\n                translate-attrs-values="{fileName: file.ui.safeAltText}"\n                aria-expanded="{{fileViewer.canRenderFileBlockPreview()}}"\n                aria-controls="file-{{ blockId() }}"\n                class="file-name file-viewer-show-view-inline"\n                ng-click="fileViewer.toggleFileView(blockId()); $event.stopPropagation()"\n              >\n                {{file.linkName}}\n              </button>\n              <span ng-switch-default class="file-name js-file-name">\n                {{file.linkName}}\n              </span>\n          </ng-switch>\n        </p>\n      </div>\n      <div class="content-item-controls file-container-controls" bb-foundation-defer>\n        <button bb-drag-handle\n                drag-item-name="{{file.linkName}}"\n                drag-item-id="{{blockId()}}"\n                class="drag-drop-button super-clear js-drag-handle"\n                tabindex="0"\n                bb-translate-attrs="{\'aria-label\': \'components.directives.file-viewer.aria.moveFile\', \'title\':\'components.directives.file-viewer.moveFile\'}"\n                translate-attrs-values="{fileName: file.ui.safeAltText}"\n                ng-if="allowReorder() && canEdit() && hasEditCallback"\n                analytics-id="components.directives.fileViewer.moveFile.button">\n          <bb-svg-icon size="small" icon="move-item-up-down"\n                       bb-translate-attrs="{\'aria-label\': \'components.directives.file-viewer.aria.moveFile\', \'title\':\'components.directives.file-viewer.moveFile\'}"\n                       translate-attrs-values="{fileName: file.linkName}"></bb-svg-icon>\n        </button>\n        <div ng-if="fileViewer.canShowAlly" class="ally-icons" id="file-preview-{{ blockId() }}">\n          <span class="score-indicator" data-ally-content-ref="{{::fileViewer.allyContentRefId}}" data-ally-show="instructorfeedback" style="display: none">\n            <bb-ally-show content-id="{{::fileViewer.allyContentRefId}}" show-icon="true" show-view-score-link="true"></bb-ally-show>\n          </span>\n          <span \n            class="alt-format"\n            ng-if="fileViewer.canShowAllyAlternativeFormats()"\n            data-ally-content-ref="{{::fileViewer.allyContentRefId}}"\n            data-ally-show="alternativeformats"\n            style="display: none"\n          >\n            <bb-ally-show content-id="{{::fileViewer.allyContentRefId}}" show-icon="true" show-alternative-formats-link="true"></bb-ally-show>\n          </span>\n        </div>\n        <bb-overflow-menu ng-if="fileViewer.overflowMenuOptions.menuItems"\n                          element-id="{{::fileViewer.instanceId + \'-\' + blockId()}}"\n                          menu-items="fileViewer.overflowMenuOptions.menuItems"\n                          element-name="{{file.ui.safeAltText}}"\n                          on-menu-toggle="fileViewer.updateAlly()"\n                          analytics-id-tag-prefix="components.directives.file-viewer.overflowMenu"\n                          ng-attr-data-ally-content-ref="{{::fileViewer.allyContentRefId}}"\n                          ng-attr-data-ally-show="{{ fileViewer.overflowMenuIsAllyConditional() ? \'instructorfeedback\' : undefined }}">\n        </bb-overflow-menu>\n        <div class="toggle-expand" ng-if="fileViewer.showViewInlineButton">\n          <div class="toggle-expand-separator"></div>\n          <button\n            analytics-id="components.directives.fileViewer.previewFile.button"\n            bb-translate-attrs="{\'aria-label\': fileViewer.canRenderFileBlockPreview() ? \'components.directives.file-viewer.aria.hideFile\' : \'components.directives.file-viewer.aria.viewFile\', \'title\':fileViewer.canRenderFileBlockPreview() ? \'components.directives.file-viewer.hideFile\' : \'components.directives.file-viewer.viewFile\'}"\n            translate-attrs-values="{fileName: file.ui.safeAltText}"\n            ng-click="fileViewer.toggleFileView(blockId()); $event.stopPropagation()"\n            aria-expanded="{{fileViewer.canRenderFileBlockPreview()}}"\n            aria-controls="file-{{ blockId() }}"\n            class="toggle-expand-button"\n          >\n            <bb-ui-icon-small-chevron-down\n              ng-if="!fileViewer.canRenderFileBlockPreview()"></bb-ui-icon-small-chevron-down>\n            <bb-ui-icon-small-chevron-up\n              ng-if="fileViewer.canRenderFileBlockPreview()"></bb-ui-icon-small-chevron-up>\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <div \n      class="file-preview"\n      ng-show="fileViewer.canRenderFileBlockPreview()"\n      id="file-{{blockId()}}"\n    >\n      <iframe class="file-viewer-iframe"\n              ng-if="fileViewer.canLoadFileBlockInline(blockId())"\n              ng-src="{{file.ui.trustedViewUrl}}"\n              id="file-{{blockId()}}"\n              allowfullscreen="true"\n              ng-show="file.viewerData && file.viewerData.viewerUrl">\n      </iframe>\n      <bb-ally-content-ref\n        ng-if="file.ui.mediaType !== \'image\'"\n        content-id="{{::fileViewer.allyContentRefId}}"\n        file-id="{{::fileViewer.xythosId}}"\n        file-preview-url="{{::file.downloadUrl}}"\n      ></bb-ally-content-ref>\n      <div class="file-viewer-img-container text-center" ng-if="fileViewer.canRenderFileBlockPreview() && file.downloadUrl != null && file.ui.canBeRenderedInline" ng-switch="file.ui.mediaType" id="file-{{blockId()}}">\n        <div ng-switch-when="image">\n          \x3c!-- LRN-109587 if an image hasn\'t been set as decorative and doesn\'t have any alt text, do not use the alt attribute at all otherwise it may mistakenly be interpreted as decorative --\x3e\n          <bb-media-gallery ng-if="file.isDecorative">\n            <img\n              class="js-media-gallery-image"\n              ng-src="{{fileViewer.convertImageUrl(file.downloadUrl)}}"\n              data-content-id-for-ally="{{::fileViewer.allyContentRefId}}"\n              data-file-eid-for-ally="{{::fileViewer.xythosId}}"\n              data-file-preview-url-for-ally="{{::file.downloadUrl}}"\n              data-richcontent-index-for-ally="{{allyIndex}}"\n              alt=""\n              data-file-name="{{file.linkName}}"\n              aria-hidden="true"\n            />\n          </bb-media-gallery>\n          <bb-media-gallery ng-if="!file.isDecorative && file.ui.safeAltText">\n            <img\n              class="js-media-gallery-image"\n              ng-src="{{fileViewer.convertImageUrl(file.downloadUrl)}}"\n              data-content-id-for-ally="{{::fileViewer.allyContentRefId}}"\n              data-file-eid-for-ally="{{::fileViewer.xythosId}}"\n              data-file-preview-url-for-ally="{{::file.downloadUrl}}"\n              data-richcontent-index-for-ally="{{allyIndex}}"\n              alt="{{file.ui.safeAltText}}"\n              data-file-name="{{file.linkName}}"\n            />\n          </bb-media-gallery>\n          <bb-media-gallery ng-if="!file.isDecorative && !file.ui.safeAltText">\n            <img\n              class="js-media-gallery-image"\n              ng-src="{{fileViewer.convertImageUrl(file.downloadUrl)}}"\n              data-content-id-for-ally="{{::fileViewer.allyContentRefId}}"\n              data-file-eid-for-ally="{{::fileViewer.xythosId}}"\n              data-file-preview-url-for-ally="{{::file.downloadUrl}}"\n              data-richcontent-index-for-ally="{{allyIndex}}"\n              data-file-name="{{file.linkName}}"\n            />\n          </bb-media-gallery>\n        </div>\n\n        <audio ng-switch-when="audio" ng-src="{{fileViewer.convertImageUrl(file.downloadUrl)}}" controls controlslist="nodownload" aria-label="{{file.ui.safeAltText}}"></audio>\n        <video ng-switch-when="video" ng-src="{{fileViewer.convertImageUrl(file.downloadUrl)}}" controls disablePictureInPicture controlslist="nodownload" aria-label="{{file.ui.safeAltText}}">\n          <p>{{file.ui.safeAltText}}</p>\n        </video>\n      </div>\n    </div>\n  </div>\n</div>\n<bb-file-property-dialog\n  ng-if="!!fileViewer.fileForEdit"\n  analytics-id="file-viewer"\n  hidden="!fileViewer.fileForEdit"\n  file="fileViewer.fileForEdit"\n  supports-inline-document-render="fileViewer.inlineFilePreviewEnabled"\n  can-provide-description="true"\n  on-save="fileViewer.onEditSave"\n  on-cancel="fileViewer.onEditCancel"\n></bb-file-property-dialog>\n'},BhPl:function(e,t,i){"use strict";var n=i("Llzl"),o=i("12mu"),s=i("lEL+"),l=i("Q/M7"),a=i("ItZ7"),r=i("l03J");i.d(t,"a",(function(){return c}));const c="ultra.components.directives.mediaGallery";class d{constructor(e,t,i,n,o){this.scope=e,this.element=t,this.attrs=i,this.$modal=n,this.timeout=o,this.$backstage=this.element.find(".media-gallery-backstage"),this.$stage=this.element.find(".media-gallery-stage"),e.$watch(()=>this.countMediaElements(),t=>{o(()=>{this.renderGallery()},e,0)})}syncClonedImage(e,t,i){i.forEach(i=>{const{from:n,to:o=n,addWatcher:s}=i;null!=e.attr(n)&&t.attr(o,e.attr(n)),s&&this.scope.$watch(()=>e.attr(n),e=>{null!=e?t.attr(o,e):t.removeAttr(o)})})}countMediaElements(){return this.element.find(".media-gallery-backstage").children().length}renderGallery(){this.$stage.empty(),this.$backstage.children().each((e,t)=>{const i=n.element(t);if(i.is("img")){const e=i.attr("src"),t=i.attr("data-file-name"),o=n.element("<img />").attr("src",l.h(e,t));n.element("<a></a>").attr("href",i.attr("src")).append(o).click(e=>{e.preventDefault(),this.openGallery(i)}).appendTo(this.$stage),this.syncClonedImage(i,o,[{from:"alt",addWatcher:!0},{from:"aria-hidden",addWatcher:!0},{from:"data-content-id-for-ally",to:"data-ally-content-id"},{from:"data-file-eid-for-ally",to:"data-ally-file-eid"},{from:"data-file-preview-url-for-ally",to:"data-ally-file-preview-url"},{from:"data-richcontent-index-for-ally",to:"data-ally-richcontent-index",addWatcher:!0}])}else i.is("video")?n.element("<video></video>").attr("src",i.attr("src")).attr("controls","controls").appendTo(this.$stage):i.is("audio")&&n.element("<audio></audio>").attr("src",i.attr("src")).attr("controls","controls").appendTo(this.$stage)})}openGallery(e){const t=n.element(r),i=n.element("<img />").attr("src",e.attr("src"));null!=e.attr("alt")&&i.attr("alt",e.attr("alt")),i.appendTo(t.find(".media-gallery-wrapper")),this.modalInstance=this.$modal.open({template:t[0].outerHTML,scope:this.scope,darkenBackdrop:!0})}closeGallery(){this.modalInstance.close()}}d.$inject=["scope","element","attrs",o.b,s.b];class h{constructor(e,t){this.$injector=e,this.$modal=t,this.restrict="E",this.template=a,this.scope=!0,this.transclude=!0,this.link=(e,t,i)=>{e.mediaGallery=this.$injector.instantiate(d,{scope:e,element:t,attrs:i,$modal:this.$modal})}}}h.$inject=["$injector",o.b],n.module(c,[o.a]).directive("bbMediaGallery",["$injector",e=>e.instantiate(h)])},EJCD:function(e,t,i){"use strict";(function(e){i.d(t,"a",(function(){return I}));var n=i("D57K"),o=(i("HAUB"),i("t3aq")),s=i("Llzl"),l=i("FpRh"),a=i("laCM"),r=i("cs5G"),c=i("0JpG"),d=i("BhPl"),h=i("Ocaa"),b=i("k9iv"),u=i("ohO4"),m=i("wmAO"),p=i("+4Px"),g=i("JNtI"),v=i("e6jQ"),f=i("Q/M7"),w=i("7scS"),k=i("aHpC"),y=i("IbyE"),B=i("NHPZ"),C=i("esJU");const I="ultra.components.directives.fileViewer";let E=class{constructor(e,t,i,n,o,s,l,a){this.scope=e,this.element=t,this.attrs=i,this.$http=n,this.errorModalService=o,this.localizeService=s,this.allyService=l,this.featureFlagService=a,this.instanceId=v.a(),this.inlineFilePreviewEnabled=!1,this.fileForEdit=void 0,e.currentVisible=null,e.loadedFileBlocks={},this.xythosId=this.allyService.getXythosIdFromContentFileUrl(e.file.downloadUrl),this.allyContentRefId=e.blockId(),this.setupOverflowMenu(this.scope.file,this.scope.index),this.allyService.isAvailable().then(e=>{this.canShowAlly=e,this.updateAlly(),this.setupOverflowMenu(this.scope.file,this.scope.index),this.scope.$root.$broadcast("menuItems.update",this.overflowMenuOptions.elementId,this.overflowMenuOptions.menuItems)}),this.onEditSave=this.onEditSave.bind(this),this.onEditCancel=this.onEditCancel.bind(this),this.featureFlagService.createWaiter("feature.course.content.inline-render").then(e=>this.inlineFilePreviewEnabled=e)}updateAlly(){this.canShowAlly&&(this.allyService.update(this.scope,this.scope.rootContentId,this.xythosId),this.allyService.onUpdate(o.UpdateEvent.InstructorFeedback,this.xythosId,e=>{this.scope.file.alternativeText=e.description,this.scope.file.isDecorative=e.decorative}))}setupOverflowMenu(e,t){this.overflowMenuOptions={elementId:this.instanceId+"-"+this.scope.blockId(),menuItems:[{labelKey:"components.directives.file-viewer.editFile",icon:"draw",show:()=>this.showEditButton&&(!this.displayAsCompactCard||this.isMediaFile(e)),onClick:()=>{var e;this.fileForEdit={alternativeText:this.scope.file.alternativeText,resourceUrl:this.scope.file.downloadUrl,viewerUrl:null===(e=this.scope.file.viewerData)||void 0===e?void 0:e.viewerUrl,fileName:this.scope.file.linkName,isDecorative:this.scope.file.isDecorative,displayName:this.scope.file.linkName,mimeType:this.scope.file.currentMimeType,render:this.scope.file.render}},ariaLabel:()=>this.localizeService.translateSync({locale:this.localizeService.getLocale(this.scope),key:"components.directives.file-viewer.aria.editFile",params:{fileName:e.linkName},noWrap:!0})},{labelKey:"components.directives.file-viewer.deleteFile",icon:"trash",show:()=>this.showDeleteButton,onClick:this.scope.deleteFunc.bind(void 0,e,t),confirmationOptions:g.a("x-bb-file"),ariaLabel:()=>this.localizeService.translateSync({locale:this.localizeService.getLocale(this.scope),key:"components.directives.file-viewer.aria.deleteFile",params:{fileName:this.scope.file.linkName},noWrap:!0})},{labelKey:this.canShowAlly?"ally.context_menu.download_original_file":"global.download",icon:"download",show:()=>this.showDownloadButton,onClick:this.download.bind(this,this.scope.file),ariaLabel:()=>this.localizeService.translateSync({locale:this.localizeService.getLocale(this.scope),key:"components.directives.file-viewer.aria.downloadFile",params:{fileName:this.scope.file.linkName},noWrap:!0})},{labelKey:"ally.context_menu.view_accessibility_score",icon:"ally-indicator-unscored",show:()=>this.showAllyButtons,onClick:()=>{},additionalAttributes:{"data-ally-show":"instructorfeedback","data-ally-content-ref":this.allyContentRefId,"data-ally-invoke":"instructorfeedback",style:"display:none;",onkeydown:`(function(e) {\n                if (e.keyCode === ${p.f} || e.keyCode === ${p.t}) {\n                  $(e.target).closest("li").click();\n                }\n                })(event)`}},{labelKey:"ally.context_menu.download_alternative_formats",icon:"ally-alt-formats",show:()=>this.showAllyButtons&&this.canShowAllyAlternativeFormats(),onClick:()=>{},additionalAttributes:{"data-ally-show":"alternativeformats","data-ally-content-ref":this.allyContentRefId,"data-ally-invoke":"alternativeformats",style:"display:none;",onkeydown:`(function(e) {\n                if (e.keyCode === ${p.f} || e.keyCode === ${p.t}) {\n                  $(e.target).closest("li").click();\n                }\n                })(event)`}}]}}addMenuItems(e){this.scope.delegateMenuRendering&&!0===this.scope.delegateMenuRendering()&&this.overflowMenuOptions&&e&&(this.overflowMenuOptions.menuItems.forEach(t=>{e.addMenuItem(t)}),this.overflowMenuOptions=null)}overflowMenuIsAllyConditional(){var e,t,i;return 0!==(null!==(i=null===(t=null===(e=this.overflowMenuOptions)||void 0===e?void 0:e.menuItems)||void 0===t?void 0:t.length)&&void 0!==i?i:0)&&this.overflowMenuOptions.menuItems.filter(e=>{var t;return null===(t=e.show)||void 0===t?void 0:t.call(e)}).every(e=>{var t;return void 0!==(null===(t=e.additionalAttributes)||void 0===t?void 0:t["data-ally-show"])})}canShowAllyAlternativeFormats(){return this.showDownloadButton}canRenderFileBlockPreview(){return!this.isUsingTempFileLocation()&&(this.scope.currentVisible===this.scope.blockId()||this.scope.file.ui.isRenderedInline&&this.scope.file.ui.canBeRenderedInline&&this.isMediaFile(this.scope.file))}canLoadFileBlockInline(e){return!0===this.scope.loadedFileBlocks[e]}isUsingTempFileLocation(){let e=!1;return this.scope.file.isUsingTempFileLocation&&!0===this.scope.file.isUsingTempFileLocation&&(e=!0),e}isMediaFile(t){return e.inArray(t.ui.mediaType,["image","video","audio"])>=0}isImageFile(e){return"image"===e.ui.mediaType}convertImageUrl(e){return f.c(e)}toggleFileView(e){e===this.scope.currentVisible?this.scope.currentVisible=null:(this.scope.loadedFileBlocks[e]=!0,this.scope.currentVisible=e)}get displayAsCompactCard(){return this.scope.file.ui.isRenderedInline&&this.scope.file.ui.canBeRenderedInline&&("image"===this.scope.file.ui.mediaType||"video"===this.scope.file.ui.mediaType)}get offCanvasButtonCountClass(){if(this.displayAsCompactCard)return;let e=1;return e+=this.showViewInlineButton?1:0,e+=this.showDownloadButton?1:0,e+=this.showEditButton?1:0,"buttons-"+(e+=this.showDeleteButton?1:0)}get showViewInlineButton(){const e=null==this.scope.showViewButton||null==this.scope.showViewButton()||this.scope.showViewButton(),t=this.scope.file.viewerData&&void 0!==this.scope.file.viewerData.viewerUrl;return this.inlineFilePreviewEnabled&&e&&this.scope.file.ui.isRenderedInline&&t}get showDownloadButton(){const e=!this.inlineFilePreviewEnabled||this.scope.file.render!==y.FileRenderType.InlineOnly;return null!=this.scope.file.downloadUrl&&e}get showEditButton(){return this.scope.hasEditCallback&&this.scope.canEdit()&&(null==this.scope.showEditButton||this.scope.showEditButton())}get showDeleteButton(){return this.scope.isDeleteFunctionDefined&&this.scope.canEdit()&&(null==this.scope.showDeleteButton||this.scope.showDeleteButton())}get showAllyButtons(){return this.canShowAlly}downloadFile(e){let t="";!m.b(e.linkName)&&e.ui.mediaType&&e.ui.mediaSubtype&&(t=m.a(e.ui.mediaType,e.ui.mediaSubtype));const i=e.linkName+t,n=f.c(f.h(e.downloadUrl,i));window.open(n,"_self")}openImageInNewWindow(e){const t=f.c(e.downloadUrl),i=window.open(t);i&&i.addEventListener("load",()=>{const t=i.document.getElementsByTagName("img")[0];t&&t.setAttribute("aria-label",e.ui.safeAltText)})}download(e){this.isImageFile(e)&&e.ui.safeAltText&&""!==e.ui.safeAltText?this.openImageInNewWindow(e):this.downloadFile(e)}destroyAllyEventListeners(){this.allyService.destroyListeners(this.xythosId)}onEditSave(e){this.scope.onFileEdit({file:e}),this.fileForEdit=void 0,e.render===y.FileRenderType.Attachment&&(this.scope.currentVisible=null),this.scope.$apply()}onEditCancel(){this.fileForEdit=void 0,this.scope.$apply()}};E=Object(n.__decorate)([Object(n.__param)(0,Object(k.b)("scope")),Object(n.__param)(1,Object(k.b)("element")),Object(n.__param)(2,Object(k.b)("attrs")),Object(n.__param)(3,Object(k.b)("$http")),Object(n.__param)(4,Object(k.b)(b.d)),Object(n.__param)(5,Object(k.b)(c.serviceName)),Object(n.__param)(6,Object(k.b)(r.b)),Object(n.__param)(7,Object(k.b)(u.b))],E);class x{constructor(e){this.$injector=e,this.restrict="E",this.template=w,this.require="?^^bbOverflowMenuContainer",this.scope={areNewAddContentButtonsHidden:"&?",attachHandler:"=?",canEdit:"&?",showDeleteButton:"&",showEditButton:"&",showViewButton:"&?",disableDrag:"&?",onFileEdit:"&",deleteFunc:"&",file:"=",firstLoadComplete:"&?",fileBeingUploaded:"&?",targetDiv:"@?",showAddContentWidget:"=?",index:"=",blockId:"&?",delegateMenuRendering:"&?",allowReorder:"&?",rootContentId:"@?",allyIndex:"@?"},this.link=(e,t,i,n)=>{e.fileViewer=this.$injector.instantiate(E,{scope:e,element:t,attrs:i}),e.hasEditCallback=!s.isUndefined(i.onFileEdit),e.isDeleteFunctionDefined=!s.isUndefined(i.deleteFunc),e.fileViewer.addMenuItems(n),e.$on("$destroy",()=>{e.fileViewer.destroyAllyEventListeners()})}}}x.$inject=["$injector"],s.module(I,[d.a,h.a,g.b,l.a,a.a,r.a,B.a,C.a]).directive("bbFileViewer",["$injector",e=>e.instantiate(x)])}).call(this,i("5iHu"))},FjTA:function(e,t){e.exports='<div ng-cloak id="document-panel" class="create-document content-base" ng-class="{\'can-edit-document\': contentCreateItem.canEdit()}">\n  <ng-form name="contentDocumentForm" bb-autosave debounce-save-destination="\'browserLocalStorage\'" save-func="contentCreateItem.persist()" validation-func="contentCreateItem.validate()"\n           novalidate>\n    <div class="panel-wrap has-bb-panel-header">\n      <header class="black-panel-header">\n        <div class="black-header-contents">\n          <button class="left-off-canvas-toggle menu-toggle standard-button dark-background"\n                  type="button"\n                  analytics-id="course.content.document.menuToggle.button">\n            <bb-svg-icon size="small" icon="main-menu"></bb-svg-icon>\n            <span class="sr-only" bb-translate>course.content.menu</span>\n          </button>\n          <h1 class="panel-title" bb-translate>{{contentCreateItem.pageTitle}}</h1>\n          <a class="standard-button dark-background"\n             ng-if="contentCreateItem.showConversations()"\n             bb-peek-sref="conversations({courseId: contentCreateItem.newContent.courseId, contentId: contentCreateItem.newContent.id})"\n             bb-translate-attrs="{\'aria-label\':\'components.directives.header.openAria\'}"\n             analytics-id="course.content.document.contentCreateItem.newContent.link">\n            <bb-svg-icon size="small" icon="conversation" ng-class="{\'has-indicator\': contentCreateItem.hasClassIndicator}"></bb-svg-icon>\n          </a>\n          <a class="standard-button dark-background"\n             ng-if="contentCreateItem.showSettings()"\n             bb-peek-sref="document-settings"\n             analytics-id="course.content.document.contentCreateItem.showSettings.link">\n            <bb-svg-icon size="small" icon="settings"></bb-svg-icon>\n          </a>\n        </div>\n      </header>\n      <section class="panel-content" ng-switch="::contentCreateItem.showPage()">\n        <bb-panel-header\n          auto-title="true"\n          can-edit="contentCreateItem.canEdit()"\n          content="contentCreateItem.newContent"\n          localization-key="x-bb-page"\n          max-length="333"\n          ng-class="{\'has-indicator\': contentCreateItem.hasClassIndicator}"\n          panel-title="contentCreateItem.title"\n          ondelete-func="contentCreateItem.deleteClicked()"\n          onchange-func-visibility="contentCreateItem.onVisibilityChanged()"\n          onblur-func-title="contentCreateItem.saveTitle()"\n          on-restricted-selected-func-title="contentCreateItem.onRestrictedSelected()"\n          open-panel-on-restricted="false"\n          settings-disabled="contentCreateItem.settingsDisabled()"\n          settings-peek-ref="document-settings"\n          settings-label="components.directives.header.settings"\n          show-conversations="contentCreateItem.showConversations()"\n          show-course="true"\n          show-delete="false"\n          show-settings="contentCreateItem.showSettings()"\n          show-slider="false"\n          show-visibility="contentCreateItem.shouldShowVisibility()"\n          show-empty-title-reminder="true"\n          show-ally-icon="true"\n        >\n        </bb-panel-header>\n        <bb-ui-content-tabs \n          ng-if="contentCreateItem.canViewProgress()"\n          value="contentCreateItem.currentTabId"\n          on-change="contentCreateItem.changeTab"\n          is-organization="contentCreateItem.isOrganization"\n        ></bb-ui-content-tabs>\n        <div\n          ng-show="contentCreateItem.currentTabId === \'content\'"\n          role="tabpanel"\n          aria-labelledby="content-tab-content"\n          id="content-tab-panel-content">\n          <bb-content-navigator content="contentCreateItem.newContent"></bb-content-navigator>\n          <div class="spinner bb-secondary-color-2" ng-switch-default aria-hidden="true"></div>\n          <div class="course-document-content">\n            <div class="panel-row large-12 columns panel-content-inner" ng-switch-when="true" ng-class="{\'is-empty-page\': (contentCreateItem.canEdit() && !contentCreateItem.hasContentBlocks)}">\n              <bb-file-upload\n                url="/v1/files"\n                data="{}"\n                target-div="#bbml-editor-empty"\n                monitor-leave="true"\n                allow-multiple="true"\n                hide-transclude-during-upload="false"\n                disable-drag="contentCreateItem.hasContentBlocks"\n                skip-zip-file-check="true"\n                click-enabled="false"\n                class="js-file-upload-empty-state"\n                primary-key="::contentCreateItem.bbmlEditorId"\n                web-location="{{contentCreateItem.newContent.children[0].body.webLocation}}"\n                file-location="{{contentCreateItem.newContent.children[0].body.fileLocation}}"\n                disallow-folder-uploads="true"\n                ignored-states="[\'edit-file-settings\',\'conversations\']">\n\n                <div class="is-empty-wrapper" ng-if="contentCreateItem.canEdit() && !contentCreateItem.hasContentBlocks">\n                  <div class="is-empty-explanation">\n                    <img src="./static/images/ftue/document-empty-state.png" alt="" />\n                    <h2 class="is-empty-heading" bb-translate="course.content.document.emptyDocument.header"></h2>\n                    <span bb-translate="course.content.document.emptyDocument.message"></span>\n                  </div>\n                </div>\n\n                <bb-document-editor\n                  bbml="contentCreateItem.newContent.children[0].body"\n                  is-privileged="contentCreateItem.canEdit()"\n                  parent-tool-instance-name="{{contentCreateItem.title}}"\n                  edit-file-peek-panel-name="edit-file-settings"\n                  has-content-blocks-or-upload="contentCreateItem.hasContentBlocks"\n                  root-content-id="{{::contentCreateItem.newContent.id}}"\n                  body-content-id="{{::contentCreateItem.newContent.children[0].id}}"\n                >\n                </bb-document-editor>\n\n                <div id="#bbml-editor-empty" class="file-details">\n                  <bb-progress primary-key="::contentCreateItem.bbmlEditorId" display-results="false" target-div="#bbml-editor-empty"></bb-progress>\n                </div>\n\n              </bb-file-upload>\n              <div bb-in-view="contentCreateItem.markCompleted()"></div>\n            </div>\n          </div>\n        </div>\n        <div\n          ng-if="contentCreateItem.currentTabId === \'progress\' && contentCreateItem.newContent.id"\n          role="tabpanel"\n          id="content-tab-panel-progress"\n          aria-labelledby="content-tab-progress"\n        >\n          <bb-ui-content-progress-view\n            course-id="contentCreateItem.courseId"\n            content-id="contentCreateItem.newContent.id"\n            is-organization="contentCreateItem.isOrganization"\n            requires-manual-marking="!contentCreateItem.newContent.inSequence"\n            analytics-id="course.content.document.progress"\n          ></bb-ui-content-progress-view>\n        </div>\n      </section>\n      \x3c!-- /panel-content --\x3e\n    </div>\n    \x3c!-- /panel-wrap --\x3e\n  </ng-form>\n  <div ui-view="document-peek@"></div>\n</div>\n'},Gfig:function(e,t){e.exports='<div class="content-conversation-toggle row collapse input-block">\n  <div class="columns" ng-show="contentConversationToggle.isStatic">\n    <button class="button-anchor"\n      analytics-id="content.conversation.toggle.button">\n      <span ng-show="contentConversationToggle.content.allowConversations" bb-translate course-org-token-resolver>course.content.conversationsAllowed</span>\n      <span ng-show="!contentConversationToggle.content.allowConversations" bb-translate course-org-token-resolver>course.content.conversationsNotAllowed</span>\n    </button>\n  </div>\n  <div class="columns small-12 allow-class-conversations" ng-show="!contentConversationToggle.isStatic">\n    <input type="checkbox"\n           name="allowConversations"\n           id="allow-class-conversations-checkbox"\n           class="allow-class-conversations-checkbox"\n           bb-translate-attrs="{\'aria-label\':\'course.content.allowConversations\'}"\n           ng-model="contentConversationToggle.content.allowConversations"\n           ng-change="contentConversationToggle.update()"\n           ng-blur="contentConversationToggle.onBlur()"\n           ng-disabled="contentConversationToggle.isDisabled || contentConversationToggle.isGradingColumnAnonymous()"\n           aria-checked="{{ contentConversationToggle.content.allowConversations }}"\n           course-org-token-resolver\n           analytics-id="course.content.conversation.input.checkbox"/>\n    <label bb-translate-attrs="{\'aria-label\':\'course.content.allowConversations\'}" class="inline-form-label"\n           for="allow-class-conversations-checkbox" course-org-token-resolver>\n      <bb-translate course-org-token-resolver>course.content.allowConversations</bb-translate>\n    </label>\n    <bb-translate class="label-description" ng-if="!!labelDetails" course-org-token-resolver>{{labelDetails}}</bb-translate>\n    <span class="toggle-restriction" ng-if="contentConversationToggle.isGradingColumnAnonymous()" bb-translate course-org-token-resolver>course.content.conversationsRestrictionAnonymousGrading</span>\n  </div>\n</div>'},Gyfs:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("1ZbL"),o=i("kcGO");const s="ultra.components.services.contentTabs",l={Class:o.ContentTabs,attributes:["analyticsId"],bindingNames:["value","onChange","isOrganization"],renderLocalized:!0,withProvider:!0};angular.module(s,[]).component("bbUiContentTabs",Object(n.a)(l))},HAUB:function(e,t,i){},HjlN:function(e,t,i){"use strict";i.r(t);var n=i("Llzl"),o=i("bd9L"),s=i("D57K"),l=i("5MwF"),a=i("nsO7"),r=i("9zo4"),c=i("cs5G"),d=i("lx16"),h=i("IQvf"),b=i("Oyr+"),u=i("ERkP"),m=i("7nmT"),p=i("vtwu"),g=i("4JTD"),v=i("aHpC"),f=i("yC9S"),w=i("0JpG");const k="ultraUi.components.directives.editor.htmlEditor",y=angular.module(k,[]);let B=class{constructor(e,t,i){this.$scope=e,this.$element=t,this.localize=i,this.onChange=(e,t)=>{t?this.ngModel.$setViewValue(e):this.ngModel.$setPristine()},this.render=()=>{const{locale:e,babelfishInstance:t,babelfishFormatter:i,isRtl:n}=this.localize.getReactBabelfishParams(this.$scope),{ngModel:o,onChange:s,readOnly:l,source:a,ariaLabel:r}=this,c={onChange:s,readOnly:l,src:a,value:o.$modelValue||"",ariaLabel:r,isRtl:n};m.render(u.createElement(g.a,{locale:e,babelfishInstance:t,babelfishFormatInstance:i,isRtl:n},u.createElement(p.HtmlEditorComponent,{...c})),this.$element[0])}}$postLink(){this.render()}$onChanges(){this.render()}$onDestroy(){m.unmountComponentAtNode(this.$element[0])}};B=Object(s.__decorate)([Object(f.a)({module:y,componentName:"bbHtmlEditor",bindings:{source:"@?",readOnly:"<?",ariaLabel:"@"},require:{ngModel:"ngModel"},requireModules:[w.moduleName]}),Object(s.__param)(0,Object(v.b)("$scope")),Object(s.__param)(1,Object(v.b)("$element")),Object(s.__param)(2,Object(v.b)(w.serviceName))],B);var C=i("Xq/A"),I=i("Fvsw"),E=i("vhkR"),x=i("k9iv"),$=i("c7N/"),O=i("ohO4"),S=i("JNtI"),F=i("ERsv"),T=i("IbyE"),L=i("jbaE"),A=i("RPq7"),j=i("Ocaa"),_=i("D8d/"),D=i("Sa5G"),M=i("f4B+"),P=i("FHk9"),R=i("EJCD"),U=i("DsaG"),V=i("lEL+"),N=i("TnpK"),z=i("gkef"),H=i("Q/M7"),G=i("e6jQ"),W=i("g66W"),q=i("elb1"),K=i("lrTQ"),J=i("kqIE"),Q=i("Qbdf"),Y=i("64sw"),X=i.n(Y),Z=i("AuQm");let ee=class e{constructor(e,t,i,n,o,s,r,c,d,h,b,u,m,p,g,v,f,w,k,y,B,C){this.scope=e,this.element=t,this.attrs=i,this._bbMLEditorService=n,this.$q=o,this.$exceptionHandler=s,this.$compile=r,this.$sce=c,this.$ngRedux=d,this.fileViewer=h,this.timeout=b,this._ultraState=u,this._accessibility=m,this.bbLocalize=p,this.windowSizeSvc=g,this.allyService=v,this.contextCourse=f,this.bbContext=w,this.ltiService=k,this.errorModal=y,this.unsafeHtml=B,this.featureFlagService=C,this.authoringBlocks=[],this.isLoaded=!1,this._isEditing=!1,this.fileUploadsinProgress=[],this.isMultiFileUpload=!1,this.uploadedFile=null,this.uploadedFileReact=null,this.supportsInlineDocumentRender=!1,this.haveUpload=!1,this.isBbMLCompliantWithWidget=!1,this.allyIndexMap=new Map,this.editorFormsByBlockId={},this.initialUpload=null,this.isSavingComplete=!0,this.confirmedToClose=!1,this.shouldAlwaysShowAddContentButton=!1,this.canEditUnsafeHtml=!1,this.handleHtmlEditError=()=>{this.errorModal.handleError(this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.scope),key:"components.directives.html-editor.editErrorModalMessage"}))},this.handleHtmlSaveError=()=>{this.errorModal.handleError(this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.scope),key:"components.directives.html-editor.saveErrorModalMessage"}))},this.canSave=e=>{var t,i,n;return(null===(i=null===(t=this.editorFormsByBlockId)||void 0===t?void 0:t[e.id])||void 0===i?void 0:i.documentEditor.$dirty)&&(null===(n=e.textBlock)||void 0===n?void 0:n.length)>0},this.prepareReadOnlyEditorPlugins=e=>{return[Object(F.link)(),Object(F.image)(),Object(F.video)(),Object(F.insertLocalFile)({apiBasePath:l.a.apiBasePath,xsrfToken:this.bbContext.xsrfToken}),Object(F.math)({courseId:e,apiBasePath:l.a.apiBasePath,xsrfToken:this.bbContext.xsrfToken,locale:this.bbLocalize.getLocale(this.scope)}),Object(F.contentMarket)({courseId:e,xsrfToken:this.bbContext.xsrfToken,apiBasePath:l.a.apiBasePath,openContentMarket:()=>{},getEmbedSrc:this.ltiService.configureAndInitInlineLaunch.bind(this.ltiService)})]},this.insertDocumentEditorTemplate=()=>{if(this.scope.isPrivileged())this.element.find(".document-editor-template").prepend(this.$compile(K)(this.scope));else if(l.a.features.useReactRendererForDocumentEditor){const{locale:e,babelfishInstance:t,babelfishFormatter:i,isRtl:n}=this.bbLocalize.getReactBabelfishParams(this.scope);X.a.renderComponent(this.element[0],this.$ngRedux,{babelfishInstance:t,babelfishFormatInstance:i,locale:e,isRtl:n,componentProps:{courseId:this.contextCourse.courseId,documentId:this.scope.rootContentId,prepareEditorPlugins:this.prepareReadOnlyEditorPlugins.bind(this)}}),this.scope.$on("$destroy",()=>{X.a.destroyComponent(this.element[0])})}else this.element.find(".document-editor-template").prepend(this.$compile(J)(this.scope))},this.onFileDropHandler=(e,t)=>{if(t){const e=this.authoringBlocks[this.findAuthoringBlockIndexById(t.id)];this.filePosition={positionAfter:this.findAuthoringBlockIndexById(e.id).toString()}}else this.filePosition={positionBefore:"0"}},this.isBlockActive=e=>this.activeBlock&&this.activeBlock.id===e.id,this.defaultCloudStorageIntegrationAttachHandler=(e,t)=>(e.ui=e.ui||{},e.ui.fileId=t.ui.fileId,e.ui.position=t.ui.position,this.scope.$broadcast("uploadComplete",e),this.$q.when()),this.bbmlEditorId="BBML_Editor_ID_"+G.b(),a.isEmpty(e.idPrefix)||(this.bbmlEditorId=e.idPrefix+this.bbmlEditorId),this.insertDocumentEditorTemplate(),e.isPrivileged&&e.isPrivileged()&&this.setUpForPrivilegedUser(),e.$watch("bbml()",e=>{null!=e?(this.BbML=e,this.parseBbML(),this.allyIndexMap=this.allyService.getIndexMapFromBbML(this.BbML.rawText),this._targetDiv=null,this.isSavingComplete=!0):this.isBbMLCompliantWithWidget=!0}),this.scope.$emit(P.EVENT_BBML_EDITOR_ID_GENERATED,this.bbmlEditorId),this.scope.$on("$stateChangeStart",(e,t,i,n)=>{const o=n.name.includes("edit.document")&&!t.name.includes("edit.document")||n.name.includes("create.document")&&!t.name.includes("create.document"),s=this.isEditing&&this.authoringBlocks.some(this.canSave);o&&s&&!this.confirmedToClose&&(e.preventDefault(),this.scope.$broadcast("show-confirmation","document-without-saving"))}),this.shouldAlwaysShowAddContentButton=!this.windowSizeSvc.isLargeBreakpoint(),this.scope.$on("window-resize",()=>{this.shouldAlwaysShowAddContentButton=!this.windowSizeSvc.isLargeBreakpoint()}),this.onMoveBlock=this.onMoveBlock.bind(this),this.onRteChange=this.onRteChange.bind(this),this.unsafeHtml.canEditUnsafeHtml().then(e=>this.canEditUnsafeHtml=e);const I=this.editorFacade();t.on("api",(t,...i)=>{const n=i[0],o=()=>{};switch(i.shift(),n){case"open":I.open(i[0],i[1]||o);break;case"closeActive":I.closeActive(i[0],i[1]||o);break;case"blockStyles":I.blockStyles(i[0]||o);break;case"getRteBlocks":I.getRteBlocks(i[0]||o);break;case"setRteBlock":I.setRteBlock(i[0],i[1]);break;default:s(new Error(`API call not implemented: ${n}`))}e.$apply()}),this.onUploadedFilePropertyDialogSave=this.onUploadedFilePropertyDialogSave.bind(this),this.onUploadedFilePropertyDialogCancel=this.onUploadedFilePropertyDialogCancel.bind(this),this.featureFlagService.createWaiter("feature.course.content.inline-render").then(e=>this.supportsInlineDocumentRender=e)}closePanel(){return this.confirmedToClose=!0,this._ultraState.leavePeekState(this._ultraState.current.name)}saveAndClosePanel(){return this.confirmedToClose=!0,this.saveHtml(this.activeBlock).then(()=>{this.saveBlocks(),this._ultraState.leavePeekState(this._ultraState.current.name)}).catch(this.handleHtmlSaveError)}set isEditing(e){this._isEditing=e}get isEditing(){return this._isEditing}get truncatedViewValue(){return this._truncatedViewValue}set truncatedViewValue(e){const t=this.element.find(".bb-editor"),i=t.length?t.text():void 0;this._truncatedViewValue=W.g(i,100)}getHtmlEditorAriaLabel(e){return this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.scope),key:"components.directives.html-editor.ariaLabel",params:{index:e}})}getHtmlBlockSrc(e){var t;return null===(t=null==e?void 0:e.fileBlock)||void 0===t?void 0:t.downloadUrl}fetchHtml(e){return this.$q.resolve(Object(T.fetchUnsafeHtml)(this.getHtmlBlockSrc(e)))}saveHtml(e){if((null==e?void 0:e.blockType)!==D.c.Html)return this.$q.resolve();const{fileBlock:t,id:i,isNewToBbML:n,textBlock:o}=e;let s,l={courseId:this.contextCourse.courseId};if(!n){s=t.file.fileName;const{fileLocation:e,webLocation:i}=this.BbML;l={...l,fileLocation:e,webLocation:i}}return this.isSavingComplete=!1,this.$q.resolve(Object(T.persistUnsafeHtml)(o,s,l).then(e=>{if(n){const t=this.findAuthoringBlockIndexById(i);this.authoringBlocks[t].fileBlock=this.transformFileIntoLearnFile(e)}}))}afterOnSave(e){if(this.clearActiveBlock(),e){const t=this.editorFormsByBlockId[e.id];t&&t.documentEditor.$setPristine()}}shouldDisableSave(e){return!this.canSave(e)}onHtmlEdit(e){return(null==e?void 0:e.blockType)!==D.c.Html?this.$q.resolve():this.fetchHtml(e).then(t=>{e.textBlock=t})}onHtmlSave(e){return this.saveHtml(e).then(()=>{e.isNewToBbML?this.saveBlocks():this.isSavingComplete=!0,this.afterOnSave(e)}).catch(this.handleHtmlSaveError)}onTextSave(e){this.saveBlocks(),this.afterOnSave(e)}focusEditorBlock(e){return this.timeout(()=>{this.element.find(`#${e.id} .bb-editor`).focus(),this.onEditorFocus(),this.isEditing=!0},this.scope,100)}activateEditorBlock(e){this.onEditorFocus();const t=this.findAuthoringBlockById(e);return this.onHtmlEdit(t).then(()=>{this.setEditorPristine(t),this.setActiveBlock(t),this.focusEditorBlock(t)}).catch(this.handleHtmlEditError)}setEditorPristine(e){e.originalValue=e.textBlock,this.editorFormsByBlockId[e.id].documentEditor.$setPristine()}removeBlock(e){const t=this.findAuthoringBlockIndexById(e);this.removeBlockAtIndex(t)}removeBlockAtIndex(e){this.authoringBlocks.splice(e,1).some(({blockType:e})=>e===D.c.Text)&&this.onRteChange()}deleteBlock(e){const t=this.findAuthoringBlockIndexById(e),i=this.authoringBlocks[t].isNewToBbML;this.removeBlockAtIndex(t),this.clearActiveBlock(),i||this.saveBlocks()}findAuthoringBlockById(e){return this.authoringBlocks[this.findAuthoringBlockIndexById(e)]}findAuthoringBlockIndexById(e){return this.authoringBlocks.findIndex(t=>t.id===e)}getOverflowMenuItems(e){const t=[];t.push({labelKey:"global.edit",icon:"draw",show:()=>this.showTextEditButton(),onClick:()=>this.$q.when(this.activateEditorBlock(e.id)),ariaLabel:()=>this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.scope),key:"components.directives.textEditor.overflowMenu.aria.edit",params:{truncatedText:this.truncatedViewValue},noWrap:!0})});const i={labelKey:"global.delete",icon:"trash",show:()=>this.showTextDeleteButton(),onClick:()=>this.deleteBlock(e.id),ariaLabel:()=>this.bbLocalize.translateSync({locale:this.bbLocalize.getLocale(this.scope),key:"components.directives.textEditor.overflowMenu.aria.delete",params:{truncatedText:this.truncatedViewValue},noWrap:!0})},{blockType:n}=e;if(n===D.c.Html||n===D.c.Text){const e=n===D.c.Html?"html-block":"text-block";i.confirmationOptions={lazyLoadTitleKeyAndInstructionsKey:()=>this.$q.when(Object(S.a)(e))},this.scope.choices&&(i.confirmationOptions.choices=this.scope.choices())}return t.push(i),t}showOverflowMenu(){return!(this.isEditing||!this.showTextEditButton()&&!this.showTextDeleteButton())}setUpForPrivilegedUser(){this.scope.fileEditorOptions&&this.scope.fileEditorOptions()&&this.scope.fileEditorOptions().initialUploadFile&&(this.initialUpload=this.scope.fileEditorOptions().initialUploadFile),this.scope.$on(P.EVENT_BBML_EDITOR_FORCE_UPDATE,this.saveBlocks),this.scope.$watch("bbmlEditor.hasContentBlocksOrUploads()",e=>{this.scope.hasContentBlocksOrUpload=e}),this.scope.$on("bb-bbml-editor-add-block",(e,t,i)=>{const n=this.addNewBlock(t,i);this.focusEditorBlock(n)}),this.scope.$on("bb-bbml-editor-assign-position",(e,t)=>{this.filePosition=t}),this.scope.$on(b.e,(e,t,i,n,o,s)=>{if(this.matchesBbMLEditorId(s))switch(n){case b.c.Uploading:this.fileUploadsinProgress.push(i.id),this.fileUploadsinProgress.length>1&&(this.isMultiFileUpload=!0),this.isEditing=!0;break;case b.c.Uploaded:{this.haveUpload=!0;const e={};e.webLocation=i.webLocation,e.fileLocation=i.fileLocation,e.fileName=i.fileName,e.mimeType=i.currentMimeType||i.mimeType,e.isMedia=i.isMedia;const t=this.fileViewer.isAudioFile(this.fileViewer.getMediaType(e.mimeType))||this.fileViewer.isVideoFile(this.fileViewer.getMediaType(e.mimeType));e.ui={isDecorative:!t&&i.isDecorative,alternativeText:decodeURIComponent(i.fileName),rawFileSize:i.rawFileSize,render:T.FileRenderType.Inline},this.filePosition||(this.filePosition={positionAfter:this.authoringBlocks.length.toString()}),this.BbML.fileLocation=i.fileLocation,this.BbML.webLocation=i.webLocation,a.remove(this.fileUploadsinProgress,e=>e===i.ui.id||e===i.ui.fileId),this.isMultiFileUpload||0!==this.fileUploadsinProgress.length?(this.addNewBlock(D.c.File,this.filePosition,e),this.isEditing=this.fileUploadsinProgress.length>0):(this.uploadedFile=e,this.uploadedFileReact=this.transformFileIntoReactFile(e));break}case b.c.Cancel:a.remove(this.fileUploadsinProgress,e=>e===i.id),this.isEditing=this.fileUploadsinProgress.length>0,this.saveUploads();break;case b.c.AllUploadsCompleted:this.isEditing=!1}})}matchesBbMLEditorId(e){return this.bbmlEditorId&&this.bbmlEditorId===e}saveUploads(){0===this.fileUploadsinProgress.length&&this.haveUpload&&(this.saveBlocks(),this.haveUpload=!1)}onFileEdit(e,t){const i=this.authoringBlocks.find(t=>t.id===e),n=i&&i.fileBlock;n&&(n.linkName=t.displayName,n.render=t.render,n.ui.isRenderedInline=Object(Z.isInlineRenderType)(t.render),n.isDecorative=t.isDecorative,n.alternativeText=t.alternativeText,n.ui.safeAltText=n.alternativeText?M.a.HTML(n.alternativeText):"",this.setActiveBlock(i),this.saveBlocks())}onUploadedFilePropertyDialogSave(e){this.addNewBlock(D.c.File,this.filePosition,{...this.uploadedFile,fileName:e.displayName,fileNameInTemporaryStorage:this.uploadedFile.fileName,ui:{...this.uploadedFile.ui,alternativeText:e.alternativeText,isDecorative:e.isDecorative,render:e.render}}),this.uploadedFile=null,this.uploadedFileReact=null,this.isEditing=!1,this.isMultiFileUpload=!1}onUploadedFilePropertyDialogCancel(){this.uploadedFile=null,this.uploadedFileReact=null,this.isEditing=!1,this.isMultiFileUpload=!1}onReorderBlock(e){const t=e,i=this.findAuthoringBlockIndexById(t.dragBlockId);let n=null;t.positionBeforeId?-1!==(n=this.findAuthoringBlockIndexById(t.positionBeforeId))&&-1!==i&&i<n&&n--:t.positionAfterId&&-1!==(n=this.findAuthoringBlockIndexById(t.positionAfterId))&&-1!==i&&i>n&&n++,i!==n&&-1!==i&&-1!==n&&(this.moveBlock(i,n),this.saveBlocks())}isAddFileInProgress(){let e=!1;if(this.fileUploadsinProgress.length>0)e=!0;else{e=a.findIndex(this.authoringBlocks,e=>e.fileBlock&&!0===e.fileBlock.isUsingTempFileLocation)>-1}return e}setActiveBlock(e){this.activeBlock=e}clearActiveBlock(){this.activeBlock=null,this.isEditing=!1}moveBlock(e,t){this.authoringBlocks.splice(t,0,this.authoringBlocks.splice(e,1)[0])}onMoveBlock(e){const t=new P.ReorderBlockEventInfo;t.dragBlockId=e.dragContentId,t.positionAfterId=e.positionAfterId,t.positionBeforeId=e.positionBeforeId,this.onReorderBlock(t)}toRteBlockId(e){return`${e}-rte`}onRteChange(e){this.activeBlock&&e&&(this.activeBlock.toBbML=e),this.element.trigger("api.onRteChange",[this.getRteContent()])}getRteContent(){return this.authoringBlocks.filter(({blockType:e})=>e===D.c.Text).map(({id:e,textBlock:t})=>({id:this.toRteBlockId(e),textBlock:t}))}parseBbML(){if(this.BbML.rawText){if(!this.isLoaded)return this.authoringBlocks=this.getParsedBbMLBlocks(this.BbML.rawText),void(this.isLoaded=!0);const e=this.getParsedBbMLBlocks(this.BbML.rawText);for(let t=0;t<e.length;t++)this.authoringBlocks[t]=e[t],this.authoringBlocks[t].fileBlock&&e[t].fileBlock&&this.authoringBlocks[t].fileBlock.downloadUrl!==e[t].fileBlock.downloadUrl&&(this.authoringBlocks[t].tempTrackById=null,this.authoringBlocks[t].fileBlock.isUsingTempFileLocation=!1)}else this.isLoaded=!0,this.isBbMLCompliantWithWidget=!0}getParsedBbMLBlocks(e){const t=this._bbMLEditorService.convertBbMLToContentBlocks(e);return this.isBbMLCompliantWithWidget=t.isBbmlEditorCompliant,t.contentBlocks}addNewBlock(e,t,i,n){const o=Number(t.positionBefore)||Number(t.positionAfter)+1||0;let s;const l={blockType:e,id:this._bbMLEditorService.generateBlockId(),isNewToBbML:!0};switch(e){case D.c.Html:case D.c.Text:s={...l,...n},this.authoringBlocks.splice(o,0,s);break;case D.c.File:(s={...l,fileBlock:this.transformFileIntoLearnFile(i)}).tempTrackById=s.id+"_temp",s.fileBlock.isUsingTempFileLocation=!0,this.authoringBlocks.splice(o,0,s),this.saveUploads()}return this.setActiveBlock(s),s}trackByAuthoringBlock(e){let t=null;return t=e.tempTrackById?e.tempTrackById:e.id}saveBlocks(){Promise.all(this.authoringBlocks.filter(e=>e.toBbML).map(e=>e.toBbML(!0).then(t=>{e.textBlock=t}))).then(()=>{this.BbML.rawText=this._bbMLEditorService.convertContentBlocksToBbML(this.authoringBlocks,this.isBbMLCompliantWithWidget),this.isSavingComplete=!1,this.scope.$emit(P.EVENT_BBML_EDITOR_IS_UPDATED,{bbmlEditor:this,bbml:this.BbML})})}checkBlockType(e,t){return e.blockType&&e.blockType.toString()===t}isFileUploadComplete(e){return e&&e.fileBlock&&!e.fileBlock.isUsingTempFileLocation}hasContentBlocks(){return!(!this.authoringBlocks||!this.authoringBlocks.length)}hasContentBlocksOrUploads(){return this.hasContentBlocks()||this.fileUploadsinProgress.length>0}onEditorFocus(){this.scope.$root.$broadcast("close-all-add-menus")}onEditorCancel(e){if(e.isNewToBbML)this.removeBlock(e.id);else if(e.originalValue){const t=this.findAuthoringBlockIndexById(e.id);this.authoringBlocks[t].textBlock=e.originalValue}this.clearActiveBlock()}trustAsHtml(e){const t=e?e.replace(/(.|\s*)(<a )(.|\s*)/g,'$1<a target="_blank" rel="noopener noreferrer" $3'):e;return this.$sce.trustAsHtml(this.addForcedDownloadToAnchorsAndImages(t))}addForcedDownloadToAnchorsAndImages(e){if(""===e||null==e)return"";const t=(new DOMParser).parseFromString(e,"text/html");return Array.from(t.querySelectorAll("a")).forEach(e=>{const t=e.getAttribute("href"),i=JSON.parse(e.getAttribute("data-bbfile")),n=this.defaultFileNameToUrlIfNullOrEmpty(t,i&&i.linkName);e.setAttribute("href",this.addForcedDownloadAndDownloadFileNameQueryStringIfXythosUrl(t,n))}),Array.from(t.querySelectorAll("img")).forEach(e=>{const t=e.getAttribute("src"),i=this.defaultFileNameToUrlIfNullOrEmpty(t,e.getAttribute("alt"));e.setAttribute("src",this.addForcedDownloadAndDownloadFileNameQueryStringIfXythosUrl(t,i))}),(new XMLSerializer).serializeToString(t)}defaultFileNameToUrlIfNullOrEmpty(e,t){return null!=t&&""!==t||(t=Object(H.k)(e)),t}addForcedDownloadAndDownloadFileNameQueryStringIfXythosUrl(e,t){return this.isXythosPath(e)?Object(H.h)(e,t):e}isXythosPath(e){return/\/_\d*_\d*\/embedded\/|\/bbcswebdav\//gi.test(e)}transformFileIntoLearnFile(e){if(!e)return;const{fileName:t,fileNameInTemporaryStorage:i,webLocation:n,mimeType:o,ui:s}=e,{alternativeText:l,isDecorative:a,render:r}=s||{};return{file:e,linkName:t,downloadUrl:`${n}${Object(F.encodeURIComponentExt)(i||t)}`,currentMimeType:o,isDecorative:a,alternativeText:l,render:r,ui:{canBeRenderedInline:this.fileViewer.canFileBeRenderedInline(o),isRenderedInline:this.fileViewer.canFileBeRenderedInline(o),iconClass:Object(T.getFileTypeIconClass)(o),mediaSubtype:this.fileViewer.getMediaSubType(o),mediaType:this.fileViewer.getMediaType(o),safeAltText:l?M.a.HTML(l):""}}}transformFileIntoReactFile(e){var t,i;return e?{resourceUrl:e.permanentUrl,fileName:e.fileName,fileSize:null===(t=e.ui)||void 0===t?void 0:t.rawFileSize,alternativeText:null===(i=e.ui)||void 0===i?void 0:i.alternativeText,displayName:e.fileName,mimeType:e.mimeType,render:T.FileRenderType.Inline}:null}showTextEditButton(){return this.scope.isPrivileged()}showTextDeleteButton(){return this.scope.isPrivileged()}showTextSaveButton(){return this.scope.isPrivileged()}showTextCancelButton(){return this.scope.isPrivileged()}focusTextOn(){return"bbml-text-editor-focus"}focusTextOnInit(e){return e.isNewToBbML}getPlaceholderKey(){return e.PLACEHOLDER_KEY}getEditButtonLabelKey(){return e.EDITBUTTONLABEL_KEY}getCancelButtonLabelKey(){return e.CANCELBUTTONLABEL_KEY}showFileEditButton(){return this.scope.isPrivileged()&&!this.isAddFileInProgress()&&(!this.scope.fileEditorOptions||null==this.scope.fileEditorOptions().showEditButton||this.scope.fileEditorOptions().showEditButton())}showFileDeleteButton(){return this.scope.isPrivileged()&&!this.isAddFileInProgress()&&(!this.scope.fileEditorOptions||null==this.scope.fileEditorOptions().showDeleteButton||this.scope.fileEditorOptions().showDeleteButton())}showFileViewButton(){return!this.isAddFileInProgress()&&(!this.scope.fileEditorOptions||null==this.scope.fileEditorOptions().showViewButton||this.scope.fileEditorOptions().showViewButton())}isInlineEditingDisabled(){return!1}noValidationMessage(){return!1}get textDeleteConfirmHandler(){return"text-block"}get textCancelConfirmHandler(){return""}get textEditorElementId(){return""}get bodyContentId(){return this.scope.bodyContentId}get rootContentId(){return this.scope.rootContentId}get targetDiv(){return this._targetDiv||(this._targetDiv=this.authoringBlocks.length?this.authoringBlocks[0].id:""),this._targetDiv}getAllyIndexForFile(e){const t=this.allyService.getXythosIdFromContentFileUrl(e.downloadUrl);return this.allyIndexMap.get(t)}editorFacade(){return{closeActive:(e,t)=>{const i=this.activeBlock;this.isEditing&&i?(!0===e?this.onTextSave(i):this.onEditorCancel(i),t()):t()},open:(e,t)=>{n.isDefined(e)?this.activateEditorBlock(e).then(t):t()},blockStyles:e=>e(F.TextBlockStyles.map(({tag:e,id:t,cssClass:i})=>{const n=this.bbLocalize.getLocale(this.scope);return{level:Number.parseInt(e.trim().substring(1),10),name:this.bbLocalize.translateSync({key:`bbmlEditor.toolbar.${t}.label`,locale:n}),className:`${i}-normal`,tag:e}})),getRteBlocks:e=>e(this.getRteContent()),setRteBlock:(e,t)=>{if(a.isNil(e)||a.isNil(t))return;const i=this.authoringBlocks[this.findAuthoringBlockIndexById(e)];i&&i.blockType===D.c.Text&&this.isBlockActive(i)&&(i.textBlock=t,this.editorFormsByBlockId[i.id].documentEditor.$setDirty())}}}};ee.PLACEHOLDER_KEY="components.directives.bbml-editor.text.placeholder",ee.EDITBUTTONLABEL_KEY="components.directives.bbml-editor.save",ee.CANCELBUTTONLABEL_KEY="components.directives.bbml-editor.cancel",ee=Object(s.__decorate)([Object(s.__param)(0,Object(v.b)("scope")),Object(s.__param)(1,Object(v.b)("element")),Object(s.__param)(2,Object(v.b)("attrs")),Object(s.__param)(3,Object(v.b)(C.c)),Object(s.__param)(4,Object(v.b)("$q")),Object(s.__param)(5,Object(v.b)("$exceptionHandler")),Object(s.__param)(6,Object(v.b)("$compile")),Object(s.__param)(7,Object(v.b)("$sce")),Object(s.__param)(8,Object(v.b)("$ngRedux")),Object(s.__param)(9,Object(v.b)(U.b)),Object(s.__param)(10,Object(v.b)(V.b)),Object(s.__param)(11,Object(v.b)(N.d)),Object(s.__param)(12,Object(v.b)(r.c)),Object(s.__param)(13,Object(v.b)(w.serviceName)),Object(s.__param)(14,Object(v.b)(z.b)),Object(s.__param)(15,Object(v.b)(c.b)),Object(s.__param)(16,Object(v.b)(Q.e)),Object(s.__param)(17,Object(v.b)(I.b)),Object(s.__param)(18,Object(v.b)(E.b)),Object(s.__param)(19,Object(v.b)(x.d)),Object(s.__param)(20,Object(v.b)($.b)),Object(s.__param)(21,Object(v.b)(O.b))],ee);class te{constructor(e){this.$injector=e,this.restrict="E",this.template=q,this.scope={attachHandler:"=?",bbml:"&",editFilePeekPanelName:"@?",hasContentBlocksOrUpload:"=?",isPrivileged:"&",readOnly:"&?",parentToolInstanceName:"@?",fileEditorOptions:"&?",idPrefix:"@?",rootContentId:"@?",bodyContentId:"@?"},this.link=(e,t,i)=>{e.bbmlEditor=this.$injector.instantiate(ee,{scope:e,element:t,attrs:i})}}}te.$inject=["$injector"],n.module("ultra.components.directives.documentEditor",["ngSanitize",d.a,k,C.b,L.a,A.b,j.a,_.a,x.c,$.a,R.a,U.a,V.a,c.a,h.a]).directive("bbDocumentEditor",["$injector",e=>e.instantiate(te)]);var ie=i("mb/O"),ne=i("UioO"),oe=i("TB6y"),se=i("lmMM"),le=i("NxQJ"),ae=i("bF8R"),re=i("jhBu"),ce=i("w9Zy"),de=i("MUzn"),he=i("nYZ0"),be=i("X455"),ue=i("pjml"),me=i("36CG"),pe=i("43zP"),ge=i("Y+9S"),ve=i("zGdY"),fe=i("kcGO");const we="ultra.features.course.content.document.controller";class ke extends de.b{constructor(e,t,i,n,o,s,l,a,r,c,d,h,b,u,m,p,g,v,w){super(e,t,i,n,o,s,l,r,c,d,h,b,u,p,g,w),this.$injector=e,this.$modal=t,this.$q=i,this.$ngRedux=n,this.$rootScope=o,this.$scope=s,this.$stateParams=l,this.$window=a,this._accessibility=r,this._bbLocalize=c,this._bbOffcanvas=d,this._content=h,this.contextCourse=b,this._CourseModel=u,this._timeout=m,this._ultraState=p,this.currentContent=g,this.contextCourseMembership=v,this.entitlementService=w,this.isLeaving=!1,this.hasContentBlocks=!0,this.isLoading=!0,this.hasClassIndicator=!1,this.currentTabId=fe.ContentTabId.Content,this.changeTab=e=>{this.currentTabId=e,this._ultraState.search("view",e)},s.contentCreateItem=this,this.confirmCancellation=!1,this.defaultTitle=this._bbLocalize.translateSync({locale:this._bbLocalize.getLocale(this.$scope),key:"course.content.document.titlePlaceholder"}),this.conversationMode="create",this.getBasicContentPromise.then(()=>{this.isCreateState?null==this.newContent.id&&(this.pageTitle=this._bbLocalize.translateSync({locale:this._bbLocalize.getLocale(this.$scope),key:"course.content.createDocument"}),this.newContent.title=this.defaultTitle,this.newContent.contentHandler=ue.p.ContentHandler.Folder,this.newContent.contentDetail={},this.newContent.contentDetail[ue.p.ContentHandler.Folder.toString()]={isBbPage:!0,ui:{hasConversationAttached:!1}}):this.isEditState&&(this.pageTitle=this.newContent.canEdit()?this._bbLocalize.translateSync({locale:this._bbLocalize.getLocale(this.$scope),key:"course.content.editDocument"}):this._bbLocalize.translateSync({locale:this._bbLocalize.getLocale(this.$scope),key:"course.content.document.title"}),this.showDeleteButton=!0)}).then(()=>{this.getChildDocument(),this.showConversations()&&this.updateIndicators()}),this.$scope.$on(ue.d.EVENT_BBML_EDITOR_IS_UPDATED,(e,t)=>{t.bbmlEditor.bbmlEditorId===this.bbmlEditorId&&this.onBbMLUpdate()}),this.$scope.$on(ue.d.EVENT_BBML_EDITOR_ID_GENERATED,(e,t)=>{this.bbmlEditorId=t}),this.$scope.$on("update-document-allowed-conversions",(e,t)=>{this.newContent.id===t.id&&(this.newContent.allowConversations=t.allowConversations,this.newContent.ui.hasConversationAttached=t.ui.hasConversationAttached)}),f.b.OnWindow("drop.document dragover.document",(function(e){e.preventDefault()}),s);const k=this._content.indicatorCacheService.$onClassConversationIndicatorRemoved((e,t,i)=>{t===this.courseId&&i===this.newContent.id&&(this.hasClassIndicator=!1)});if(this.$scope.$on("$destroy",()=>{k()}),"progress"===l.view&&(this.currentTabId=fe.ContentTabId.Progress),this.loadCourseProgressConfiguration(b.courseId),Object(ge.isInMobileApp)()){const e={type:this.isCreateState?ge.MessageType.CreateDocument:ge.MessageType.DocumentOpened,status:ge.MessageStatus.Success,contentId:this.currentContent.contentId,contentTitle:this.title,permission:{showSettings:this.showSettings()}};if(this.showSettings()){const t=Object(ge.registerMobileEventHandler)(e);t.response.subscribe(e=>{e.event===ge.EventType.GotoSettings&&this.openDocumentSettings()}),this.$scope.$on("$destroy",()=>{Object(ge.clearMobileEventHandler)(t.correlationId)})}else Object(ge.sendMessageToMobile)(e)}}getChildDocument(){this.newContent.children=this.newContent.$pk&&this.newContent.getChildren()||this.newContent.$scope.$collection(),this.newContent.children.$then(()=>{this.newContent.children.length||this.newContent.children.buildAndRevealAtPosition({positionBefore:"start"},{title:"ultraDocumentBody",contentHandler:D.f.Document,body:{}}),this._timeout(()=>{this.isLoading=!1},this.$scope)})}showPage(){return!(this.isLoading||!this.$scope.$root.bbOffcanvasOpened)||void 0}onBbMLUpdate(){this.newContent.$pk||this.newContent.$pending&&this.newContent.$pending.length?this.newContent.$asPromise().then(()=>{this.persistDocumentChild()}):this.persist({persistChild:!0})}persist(e){return(e=e||{}).persistChild=!!e.persistChild,this.conversationService.markAllConversationsForRemoval(),super.persist().then(()=>{if(this.conversationService.checkAndAddAllConversations(),e.persistChild)return this.persistDocumentChild();this.$scope.$broadcast(o.b)})}persistDocumentChild(){const e=this.newContent.children[0];if(e)return e.$pk||e.$pending&&e.$pending.length?e.$patch():(e.parentId=this.newContent.id,e.$save()),e.$then(()=>{this.$scope.$broadcast(o.b)}),e.$asPromise()}saveClicked(){this.persist()}deleteClicked(){this.$scope.$broadcast(o.b),super.deleteClicked()}setUrlToPersisted(){!this.isLeaving&&this.isCreateState&&this.newContent&&this.newContent.id&&this._ultraState.goPeekState(this._ultraState.current.name,{id:this.newContent.id,parentId:void 0,positionBefore:void 0,positionAfter:void 0},{location:"replace"}).then(()=>{this.isCreateState=!1,this.isEditState=!0})}onVisibilityChanged(){this.persist().then(()=>{super.updateVisibility(this.newContent)})}onRestrictedSelected(){this.newContent.$asPromise().then(()=>{this.openDocumentSettings()})}openDocumentSettings(){this.persist().then(()=>{this._ultraState.goPeekState("document-settings",{focusEleId:"start-date"})})}isContentSaved(){return!(!this.newContent||!this.newContent.$pk)||void 0}isContentSavedAndCanEdit(){return!!(this.newContent&&this.newContent.$pk&&this.newContent.canEdit())||void 0}isContentSavedAndCanDelete(){return!!(this.newContent&&this.newContent.$pk&&this.newContent.canDelete())||void 0}showConversations(){return le.b.showConversations(this.newContent)||void 0}shouldShowVisibility(){var e;return"content"===this.currentTabId&&(null===(e=this.newContent)||void 0===e?void 0:e.canEditAvailability())&&!this.newContent.shouldRestrict()}showSettings(){return"content"===this.currentTabId&&this.canEdit()}settingsDisabled(){return!this.isContentSaved()}validate(){return this.$scope.contentDocumentForm&&(this.$scope.contentDocumentForm.$valid||void 0===this.$scope.contentDocumentForm.$valid)}conversationToggleDisabled(){return!(this.newContent&&this.newContent.$pk)}viewConversation(){this.conversationMode="read"}saveTitle(){this.persist()}onPanelClose(e,t,i){this.isLeaving=!0,n.element(this.$window).unbind("drop.document dragover.document");const o=!this.title||this.title===this.defaultTitle,s=1===this.newContent.children.length&&a.isEmpty(this.newContent.children[0].body);this.isCreateState&&o&&s?this.newContent.$destroy():this.autoSaveState!==pe.a.NoChanges&&this.persist({persistChild:!1}).then(()=>{this.setFocusForPanelClose(this.newContent.id)})}updateIndicators(){this._content&&this.newContent&&this._content.fetchIndicators(this.courseId).then(()=>{const e=this._content.getCourseContentCache(this.courseId,this.newContent.id);e&&(this.hasClassIndicator=e.classConversationHasIndicator)})}markCompleted(){this.newContent.permissions.canHaveReviewState&&this.newContent.state!==ve.ContentReviewState.Completed&&this.newContent.inSequence&&this._timeout(()=>{this.newContent.updateState(ve.ContentReviewState.Completed,!0)},this.$scope,1e3)}}ke.$inject=["$injector","$modal","$q","$ngRedux","$rootScope","$scope","$stateParams","$window",r.c,w.serviceName,ce.e,he.f,Q.e,ue.m.serviceName,V.b,N.d,me.c,be.d,re.b,re.b];class ye extends ke{}var Be=i("u4ux"),Ce=i("ftvW"),Ie=i("5cjn"),Ee=i("Gyfs"),xe=i("uJ9h"),$e=i("FjTA");i.d(t,"moduleName",(function(){return Oe})),i.d(t,"controllerName",(function(){return Se})),i.d(t,"template",(function(){return $e}));const Oe="ultra.features.course.content.document",Se=we;n.module(Oe,[o.e,"ultra.components.directives.documentEditor",ie.a,ne.a,se.d,oe.a,w.moduleName,ie.a,ae.a,le.c,Be.b,N.b,me.a,Ce.a,Ie.a,Ee.a,xe.a]).controller(we,class extends ke{})},IQvf:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var n=i("Llzl"),o=i("0JpG"),s=i("1ZbL"),l=i("AuQm");const a="ultra.components.directives.filePropertyDialog",r={Class:l.FilePropertyDialog,renderLocalized:!0,withProvider:!0,attributes:["analyticsId"],bindingNames:["file","hidden","supportsInlineDocumentRender","canProvideDescription","onCancel","onSave"]};n.module(a,[o.moduleName]).component("bbFilePropertyDialog",Object(s.a)(r))},ItZ7:function(e,t){e.exports='<div class="media-gallery-inline">\n  <div class="media-gallery-backstage" style="display: none" ng-transclude></div>\n  <div class="media-gallery-stage"></div>\n</div>'},NHPZ:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("zYa8"),o=i("IPrp");const s="ultra.components.directives.bbUiIcon.small.ChevronDown";Object(n.a)(o.ChevronDown,s,"bbUiIconSmallChevronDown")},X8JP:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return a}));var n=i("Vsv2"),o=i("pjml"),s=i("0JpG");const l="ultraUi.components.services.cloudDrive.rteCloudStorageIntegrationModal",a="RteCloudStorageIntegrationService",r=e=>e.account+"|"+e.id;class c{constructor(e,t,i,n){this.$q=e,this.cloudDriveService=t,this.CloudDriveModel=i,this.bbLocalize=n}initialize(){return this.cloudDriveService.isCloudServiceAvailable().then(e=>this.isCloudServiceAvailable=e)}openFilePicker(e){const t=this.bbLocalize.getLocale(e);return this.cloudDriveService.cloudDriveStorage.openFilePicker(t,!0).then(e=>{if(e){const t=[];return e.forEach(i=>{const n=r(i),o=this.CloudDriveModel.$new("CloudStorageIntegration").contents.$new(n).$fetch({accessToken:e[0].bearer_token.key}).$asPromise();t.push(o)}),this.$q.all(t).then(t=>t.map(t=>({id:t.id,cloudStorageIntegrationAccessToken:e[0].bearer_token.key,name:t.name,size:t.size,type:t.type,updatedTime:t.updatedTime,webLocation:t.webLocation})))}return this.$q.reject()})}getModalCallback(e){return()=>this.cloudDriveService.cloudDriveStorage?this.openFilePicker(e):this.cloudDriveService.initializeCloudDrive().then(()=>this.openFilePicker(e))}}c.$inject=["$q",n.b,o.h.serviceName,s.serviceName],angular.module(l,[n.a]).service(a,c)},elb1:function(e,t){e.exports='<div bb-load-bundle="components/directives/bbml-editor" class="document-editor-template"></div>'},esJU:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("zYa8"),o=i("4p3y");const s="ultra.components.directives.bbUiIcon.small.ChevronUp";Object(n.a)(o.ChevronUp,s,"bbUiIconSmallChevronUp")},jbaE:function(e,t,i){"use strict";(function(e){i.d(t,"a",(function(){return y}));var n=i("D57K"),o=(i("ph44"),i("vhkR")),s=i("cs5G"),l=i("Llzl"),a=i("Fvsw"),r=i("Qbdf"),c=i("0JpG"),d=i("X8JP"),h=i("TnpK"),b=i("ohO4"),u=i("jx5I"),m=i("5MwF"),p=i("ERsv"),g=i("Q/M7"),v=i("pjml"),f=i("Y+9S"),w=i("aHpC"),k=i("6PRJ");const y="ultraUi.components.directives.editor.richTextEditor";let B=class{constructor(e,t,i,n,o,s,l,a,r,c,d,h,b,u,m,p){this.$q=e,this.$scope=t,this.element=i,this.attrs=n,this.controllers=o,this.bbEditorFactory=s,this.bbLocalize=l,this.bbContext=a,this.ltiService=r,this.CloudStorageIntegrationModalService=c,this.AnnotationsModel=d,this.contextCourse=h,this.allyService=b,this.ultraState=u,this.featureFlagService=m,this.fileUploadSettingsService=p;const g=this.$scope.$watch("pluginOptions",e=>{e&&(g(),this.initEditor())});this.reactAllyService=this.allyService.getReactService(this.$scope),t.$on("$destroy",()=>{t.editor&&t.editor.destroy()})}initEditor(){let e=null,t=!1,i=null;const n=this.controllers.ngModel,o=n.$setPristine.bind(n);n.$viewChangeListeners.push(()=>{t||o()}),n.$setPristine=()=>{o(),i&&i(n.$modelValue)};const s=e=>{this.$scope.editor&&this.$scope.editor.update(e)};this.$scope.$watch(()=>n.$modelValue,t=>{t!==e&&s({bbml:t})}),this.$scope.$watchGroup(["isDisabled","isReadOnly","isToolbarHidden","allyIndexMap"],([e,t,i,n])=>{this.$scope.editor&&s({isDisabled:e,isReadOnly:t,isToolbarHidden:i,ally:{service:this.reactAllyService,indexMap:n}})});const l=(e,t)=>void 0!==e?e:t,a=e=>{this.$scope.fileLocation=e.data?e.data.fileLocation:e.fileLocation,this.$scope.webLocation=e.data?e.data.webLocation:e.webLocation},r=o=>{var s,l;t=o.isDirty,i=o.setPristine;const a=o.toBbML();e!==a&&(e=a,null===(l=(s=this.$scope).onChange)||void 0===l||l.call(s,o.toBbML),n.$setViewValue(a))},c={placeholderText:this.bbLocalize.translate({locale:this.bbLocalize.getLocale(this.$scope),key:this.$scope.placeholder})};this.$scope.pluginOptions&&this.$scope.pluginOptions.attachment&&(c.cloudStorageIntegration=this.CloudStorageIntegrationModalService.initialize()),c.inlineRenderFfEnabled=this.featureFlagService.createWaiter("feature.course.content.inline-render"),this.$q.all(c).then(e=>{const t=[Object(p.customClass)()],{locale:i,babelfishInstance:o,babelfishFormatter:s,isRtl:c}=this.bbLocalize.getReactBabelfishParams(this.$scope);if(this.$scope.pluginOptions){!1!==this.$scope.pluginOptions.link&&t.push(Object(p.link)()),!1!==this.$scope.pluginOptions.image&&t.push(Object(p.image)()),!1!==this.$scope.pluginOptions.video&&t.push(Object(p.video)()),this.$scope.pluginOptions.math&&t.push(Object(p.math)({apiBasePath:Object(g.c)(m.a.apiBasePath),courseId:this.contextCourse.courseId,xsrfToken:this.bbContext.xsrfToken,locale:i})),this.$scope.pluginOptions.attachment&&t.push(Object(p.insertLocalFile)({apiBasePath:Object(g.c)(m.a.apiBasePath),xsrfToken:this.bbContext.xsrfToken,webLocation:this.$scope.webLocation||"",fileLocation:this.$scope.fileLocation||"",onUploadSuccess:a,buttonId:Object(f.isInMobileApp)()?"insertFile":"",supportsInlineDocumentRender:this.$scope.supportsInlineDocumentRender&&e.inlineRenderFfEnabled,fileUploadSettings:this.fileUploadSettingsService.getSettings(),onNewAttachmentSavePressed:this.$scope.onNewAttachmentSavePressed}));let n=!0;!1===this.$scope.pluginOptions.youtubeVideo&&(n=!1),n&&t.push(Object(p.insertYoutubeVideo)({apiBasePath:Object(g.c)(m.a.apiBasePath),getEmbedSrc:this.ltiService.configureAndInitInlineLaunch.bind(this.ltiService),xsrfToken:this.bbContext.xsrfToken,courseId:this.contextCourse.courseId})),this.$scope.pluginOptions.demoMashup&&t.push(Object(p.demoMashup)()),this.$scope.pluginOptions.attachment&&this.CloudStorageIntegrationModalService.isCloudServiceAvailable&&!Object(f.isInMobileApp)()&&t.push(Object(p.insertCloudStorageIntegrationFile)({openCloudStorageIntegrationModal:this.CloudStorageIntegrationModalService.getModalCallback(this.$scope),apiBasePath:Object(g.c)(m.a.apiBasePath),xsrfToken:this.bbContext.xsrfToken,webLocation:this.$scope.webLocation||"",fileLocation:this.$scope.fileLocation||"",fileUploadSettings:this.fileUploadSettingsService.getSettings(),onNewAttachmentSavePressed:this.$scope.onNewAttachmentSavePressed})),this.$scope.pluginOptions.contentMarket&&t.push(Object(p.contentMarket)({apiBasePath:Object(g.c)(m.a.apiBasePath),getEmbedSrc:this.ltiService.configureAndInitInlineLaunch.bind(this.ltiService),noInsert:this.$scope.contentMarketIsReadOnly,openContentMarket:this.ltiService.getOpenContentMarketConf(this.$scope),xsrfToken:this.bbContext.xsrfToken}))}let d=this.$scope.rootContentId;!d&&this.ultraState&&this.ultraState.getCurrentResolvedValues&&this.ultraState.getCurrentResolvedValues().currentContent&&(d=this.ultraState.getCurrentResolvedValues().currentContent.id);const h={bbml:n.$modelValue||"",isDisabled:l(this.$scope.isDisabled,!1),isReadOnly:l(this.$scope.isReadOnly,!1),isToolbarHidden:l(this.$scope.isToolbarHidden,!1),isRtl:c,locale:i,expandInlineFilesOnLoad:this.$scope.expandInlineFilesOnLoad,supportsInlineDocumentRender:this.$scope.supportsInlineDocumentRender&&e.inlineRenderFfEnabled,babelfishInstance:o,babelfishFormatInstance:s,onChange:r,placeholder:e.placeholderText,plugins:t,editorId:this.$scope.editorId,ariaLabelledBy:this.$scope.editorAriaLabelledBy,ariaDescribedBy:this.$scope.editorAriaDescribedBy,showWordCount:this.$scope.showWordCount,ally:{service:this.reactAllyService,indexMap:this.$scope.allyIndexMap||new Map},rootContentId:d,...this.$scope.onFocus?{onFocus:()=>this.$scope.$applyAsync(this.$scope.onFocus)}:null,...this.$scope.onBlur?{onBlur:()=>this.$scope.$applyAsync(this.$scope.onBlur)}:null,...m.a.unitTesting?{mockLocalize:Object(k.a)()}:null};this.$scope.onBlur&&n.$setTouched(),this.$scope.editor=this.bbEditorFactory(this.element[0],h)})}getOnDownloadWithAnnotations(){return t=>{const i=!!t.groupAttemptFileId,n=t.attemptFileId||t.groupAttemptFileId,o={systemInfo:this.bbContext.getSystemInfo().$asPromise(),annotations:this.AnnotationsModel.downloadWithAnnotations(n,i,this.contextCourse.courseId).$asPromise()};return this.$q.all(o).then(t=>{const i=t.systemInfo.annotationRendererUrl;if(!(i&&i.length>0))throw new Error("Annotation Service url is not defined.");{const n=e("#annotationIframe");null!==n&&n.remove();const o=e("#annotationForm");null!==o&&o.remove();const s=e(document.createElement("iframe"));s.attr("src","about:blank"),s.attr("id","annotationIframe"),s.attr("name","annotationIframe"),s.css("display","none");const l=e(document.createElement("form"));l.attr("target","annotationIframe"),l.attr("method","POST"),l.attr("action",i+"/annotation/token"),l.attr("id","annotationForm"),l.attr("name","annotationForm");const a=e(document.createElement("input"));a.attr("type","hidden"),a.attr("name","jwt"),a.attr("value",t.annotations.jwt),a.appendTo(l);const r=e("body");l.appendTo(r),s.appendTo(r),l.submit()}})}}};B=Object(n.__decorate)([Object(n.__param)(0,Object(w.b)("$q")),Object(n.__param)(1,Object(w.b)("scope")),Object(n.__param)(2,Object(w.b)("element")),Object(n.__param)(3,Object(w.b)("attrs")),Object(n.__param)(4,Object(w.b)("controllers")),Object(n.__param)(5,Object(w.b)("BbEditorFactory")),Object(n.__param)(6,Object(w.b)(c.serviceName)),Object(n.__param)(7,Object(w.b)(a.b)),Object(n.__param)(8,Object(w.b)(o.b)),Object(n.__param)(9,Object(w.b)(d.b)),Object(n.__param)(10,Object(w.b)(v.c.serviceName)),Object(n.__param)(11,Object(w.b)(r.e)),Object(n.__param)(12,Object(w.b)(s.b)),Object(n.__param)(13,Object(w.b)(h.d)),Object(n.__param)(14,Object(w.b)(b.b)),Object(n.__param)(15,Object(w.b)(u.b))],B);class C{constructor(e){this.$injector=e,this.link=(e,t,i,n)=>{t.addClass("rich-text-editor"),e.richTextEditor=this.$injector.instantiate(B,{scope:e,element:t,attrs:i,controllers:n})},this.require={ngModel:"ngModel"},this.restrict="E",this.scope={contentMarketIsReadOnly:"<?",fileLocation:"=?",isDisabled:"<?",isReadOnly:"<?",isToolbarHidden:"<?",onChange:"<?",onBlur:"&?",onNewAttachmentSavePressed:"&?",onFocus:"&?",placeholder:"@?editorPlaceholderKey",pluginOptions:"<?",webLocation:"=?",editorId:"@?",editorAriaLabelledBy:"@?",editorAriaDescribedBy:"@?",showWordCount:"<?",allyIndexMap:"=?",rootContentId:"@?",expandInlineFilesOnLoad:"<?",supportsInlineDocumentRender:"<?"}}}C.$inject=["$injector"],l.module(y,[c.moduleName,a.a,d.a,o.a,s.a,u.a]).value("BbEditorFactory",p.BbEditorFactory).directive("bbRichTextEditor",["$injector",e=>e.instantiate(C)])}).call(this,i("5iHu"))},kqIE:function(e,t){e.exports='<div id="{{::bbmlEditor.bbmlEditorId}}"\n     class="bbml-editor upload-list file-viewer-container js-bbml-editor"\n     data-ally-content-id="{{::bbmlEditor.rootContentId}}"\n     data-ally-richcontent-eid="content:{{::bbmlEditor.bodyContentId}}"\n     data-ally-richcontent-selector-img="a[data-bbfile]"\n>\n  <ul class="content-list read-only" ng-if="bbmlEditor.isLoaded">\n    <li ng-repeat="authoringBlock in bbmlEditor.authoringBlocks track by bbmlEditor.trackByAuthoringBlock(authoringBlock)"\n        class="js-content-div js-bbml-block">\n      <div class="element-list-row">\n        <bb-rich-text-editor\n          ng-if="::bbmlEditor.checkBlockType(authoringBlock, \'textBlock\')"\n          ng-model="::authoringBlock.textBlock"\n          editor-id="{{bbmlEditor.toRteBlockId(authoringBlock.id)}}"\n          is-read-only="true"\n          plugin-options="{attachment: true, contentMarket: true, math: true}"\n          root-content-id="{{::rootContentId}}"\n          supports-inline-document-render="true"\n        >\n        </bb-rich-text-editor>\n        <bb-html-editor ng-if="::bbmlEditor.checkBlockType(authoringBlock, \'htmlBlock\')"\n                        ng-model="::authoringBlock.textBlock"\n                        source="{{bbmlEditor.getHtmlBlockSrc(authoringBlock)}}"\n                        read-only="true">\n        </bb-html-editor>\n        <bb-file-viewer\n          ng-if="::bbmlEditor.checkBlockType(authoringBlock, \'fileBlock\')"\n          file="::authoringBlock.fileBlock"\n          block-id="::authoringBlock.id"\n          can-edit="false"\n          root-content-id="{{::rootContentId}}"\n          ally-index="::bbmlEditor.getAllyIndexForFile(authoringBlock.fileBlock)"\n        >\n        </bb-file-viewer>\n      </div>\n    </li>\n  </ul>\n</div>\n'},l03J:function(e,t){e.exports='<bb-media-gallery-modal>\n  <button class="close-gallery" \n          ng-click="mediaGallery.closeGallery()" \n          bb-translate-attrs="{ \'aria-label\': \'global.close\' }"\n          analytics-id="components.directives.media.gallery.modal.close.button"></button>\n  <div class="media-gallery-wrapper" role="dialog" tabindex="-1">\n\n  </div>\n</bb-media-gallery-modal>'},lrTQ:function(e,t){e.exports='<div id="{{::bbmlEditor.bbmlEditorId}}" class="bbml-editor upload-list file-viewer-container js-bbml-editor"\n     bb-mouse-leave-enter="bbml-editor "\n     js-saving-complete="{{bbmlEditor.isSavingComplete}}"\n     ng-class="{\'is-editing\':bbmlEditor.isEditing || bbmlEditor.isAddFileInProgress(), \'has-top-upload-bar\': true }"\n     data-ally-content-id="{{::bbmlEditor.rootContentId}}"\n     data-ally-richcontent-eid="content:{{::bbmlEditor.bodyContentId}}"\n     data-ally-richcontent-selector-img="a[data-bbfile]">\n  \x3c!-- Edit mode --\x3e\n  <div class="drag-element js-content-div js-bbml-block">\n    <bb-add-content-button\n      always-show="bbmlEditor.shouldAlwaysShowAddContentButton"\n      hide-divider-lines="false"\n      item-name="bbmlEditor.authoringBlocks[0].fileBlock.linkName"\n      item-type="bbmlEditor.authoringBlocks[0].textBlock ? \'text\' : \'\'"\n      item-index="1"\n      disable-drag="true"\n      context-area="\'bbml-editor\'"\n      show-both-buttons="true"\n      web-location="{{bbml().webLocation}}"\n      file-location="{{bbml().fileLocation}}"\n      primary-key="::bbmlEditor.bbmlEditorId"\n      initial-upload="::bbmlEditor.initialUpload"\n      attach-handler="attachHandler ? attachHandler: bbmlEditor.defaultCloudStorageIntegrationAttachHandler"\n      ignored-states="::fileUploadInterruptIgnoreStates()"\n      ng-class="{\'is-empty-page\': !bbmlEditor.hasContentBlocksOrUploads()}">\n    </bb-add-content-button>\n\n  </div>\n  <div class="content-list" ng-if="bbmlEditor.hasContentBlocksOrUploads()">\n    <bb-file-upload\n      class="drop-insert-below"\n      url="/v1/files"\n      data="{}"\n      monitor-leave="true"\n      ignored-states="::fileUploadInterruptIgnoreStates()"\n      allow-multiple="true"\n      click-enabled="false"\n      disable-drag="disableFileDrag() || bbmlEditor.isEditing || bbmlEditor.isAddFileInProgress()"\n      hide-transclude-during-upload="false"\n      use-default-success-method="false"\n      skip-zip-file-check="true"\n      web-location="{{bbml().webLocation}}"\n      file-location="{{bbml().fileLocation}}"\n      primary-key="::bbmlEditor.bbmlEditorId"\n      target-div="{{::bbmlEditor.targetDiv}}"\n      disallow-folder-uploads="true"\n      ng-if="bbmlEditor.hasContentBlocks()">\n      <div\n        class="drag-element authoring-list-item js-content-div js-bbml-block"\n        bb-focus="{{bbmlEditor.shouldFocusOn(authoringBlock.id) || false}}"\n        ng-repeat="authoringBlock in bbmlEditor.authoringBlocks track by bbmlEditor.trackByAuthoringBlock(authoringBlock)"\n      >\n\n        <div bb-drop-handler\n             id="{{::authoringBlock.id}}"\n             tabindex="-1"\n             on-move-handler="bbmlEditor.onMoveBlock"\n             on-file-drop-handler="::bbmlEditor.onFileDropHandler"\n             content="::authoringBlock"\n             next-content-id="bbmlEditor.authoringBlocks[$index + 1].id"\n             previous-content-id="bbmlEditor.authoringBlocks[$index - 1].id"\n             disable-for-reordering="false">\n          <div bb-content-item-mouseover can-create="true" class="element-list-row">\n            <div\n              class="text-editor-wrapper"\n              ng-if="bbmlEditor.checkBlockType(authoringBlock, \'textBlock\')"\n            >\n              <div ng-show="bbmlEditor.showOverflowMenu($index)" class="content-item-controls overflow-menu-container" bb-foundation-defer>\n                <bb-overflow-menu ng-hide="false"\n                                  element-id="{{::authoringBlock.id}}"\n                                  menu-items="bbmlEditor.getOverflowMenuItems(authoringBlock)"\n                                  analytics-id-tag-prefix="components.directives.bbml-editor.itemControls.overflowMenu">\n                </bb-overflow-menu>\n                <button class="drag-drop-button icon super-clear medium button drag-handle js-drag-handle"\n                        drag-item-id="{{::authoringBlock.id}}"\n                        drag-item-name="{{bbmlEditor.truncatedViewValue}}"\n                        bb-drag-handle\n                        bb-translate-attrs="{\'title\': \'components.directives.textEditor.move\'}"\n                        aria-label="{{::bbmlEditor.getButtonLabel(\'components.directives.textEditor.aria.move\')}}"\n                        analytics-id="components.directives.textEditor.aria.move.button">\n                  <bb-svg-icon size="small" icon="move-item-up-down"></bb-svg-icon>\n                </button>\n              </div>\n              <form name="bbmlEditor.editorFormsByBlockId[\'{{authoringBlock.id}}\']">\n                <bb-rich-text-editor\n                  ng-class="{\'bb-editor-read-only-with-overflow-menu\': !bbmlEditor.isBlockActive(authoringBlock)\n                    && bbmlEditor.showOverflowMenu($index)}"\n                  class="bb-text-editor-controls-wrapper"\n                  editor-id="{{bbmlEditor.toRteBlockId(authoringBlock.id)}}"\n                  name="documentEditor"\n                  ng-model="authoringBlock.textBlock"\n                  is-read-only="!bbmlEditor.isBlockActive(authoringBlock)"\n                  is-disabled="!bbmlEditor.isSavingComplete"\n                  on-change="bbmlEditor.onRteChange"\n                  plugin-options="{attachment: true, contentMarket: true, math: true}"\n                  ally-index-map="bbmlEditor.allyIndexMap"\n                  root-content-id="{{::rootContentId}}"\n                  show-word-count="true"\n                  supports-inline-document-render="true"\n                ></bb-rich-text-editor>\n              </form>\n\n              <div class="panel-editor-controls" ng-show="bbmlEditor.isBlockActive(authoringBlock)">\n                <button class="button button--secondary js-secondary-button js-text-editor-cancel"\n                        ng-click="bbmlEditor.onEditorCancel(authoringBlock)"\n                        bb-translate analytics-id="components.directives.bbml-editor.cancel">\n                  components.directives.bbml-editor.cancel\n                </button>\n                <button class="button js-primary-button js-text-editor-save"\n                        ng-click="bbmlEditor.onTextSave(authoringBlock)"\n                        ng-disabled="bbmlEditor.shouldDisableSave(authoringBlock)"\n                        bb-translate analytics-id="components.directives.bbml-editor.save">\n                  components.directives.bbml-editor.save\n                </button>\n              </div>\n            </div>\n            \x3c!-- HTML Block --\x3e\n            <div ng-if="::bbmlEditor.checkBlockType(authoringBlock, \'htmlBlock\')"\n                 block-id="::authoringBlock.id">\n              <div ng-show="bbmlEditor.showOverflowMenu($index)"\n                   class="content-item-controls overflow-menu-container"\n                   bb-foundation-defer>\n                <bb-overflow-menu ng-if="bbmlEditor.canEditUnsafeHtml"\n                                  element-id="{{::authoringBlock.id}}"\n                                  menu-items="bbmlEditor.getOverflowMenuItems(authoringBlock)"\n                                  analytics-id-tag-prefix="components.directives.html-editor.itemControls.overflowMenu">\n                </bb-overflow-menu>\n                <button class="drag-drop-button icon super-clear medium button drag-handle js-drag-handle"\n                        drag-item-id="{{::authoringBlock.id}}"\n                        drag-item-name="{{bbmlEditor.truncatedViewValue}}"\n                        bb-drag-handle\n                        bb-translate-attrs="{\'title\': \'components.directives.textEditor.move\'}"\n                        aria-label="{{::bbmlEditor.getButtonLabel(\'components.directives.textEditor.aria.move\')}}"\n                        analytics-id="components.directives.html-editor.aria.move.button">\n                  <bb-svg-icon size="small" icon="move-item-up-down"></bb-svg-icon>\n                </button>\n              </div>\n              <form name="bbmlEditor.editorFormsByBlockId[\'{{authoringBlock.id}}\']">\n                <bb-html-editor name="documentEditor"\n                                ng-class="{\'show-overflow-menu\': bbmlEditor.showOverflowMenu($index)}"\n                                ng-model="authoringBlock.textBlock"\n                                source="{{bbmlEditor.getHtmlBlockSrc(authoringBlock)}}"\n                                aria-label={{bbmlEditor.getHtmlEditorAriaLabel($index)}}\n                                read-only="!bbmlEditor.isBlockActive(authoringBlock)">\n                </bb-html-editor>\n              </form>\n              <div class="panel-editor-controls" ng-show="bbmlEditor.isBlockActive(authoringBlock)">\n                <button class="button button--secondary js-secondary-button"\n                        ng-click="bbmlEditor.onEditorCancel(authoringBlock)"\n                        analytics-id="components.directives.html-editor.cancel"\n                        bb-translate>\n                  components.directives.bbml-editor.cancel\n                </button>\n                <button class="button js-primary-button"\n                        ng-click="bbmlEditor.onHtmlSave(authoringBlock)"\n                        ng-disabled="bbmlEditor.shouldDisableSave(authoringBlock)"\n                        analytics-id="components.directives.html-editor.save"\n                        bb-translate>\n                  components.directives.bbml-editor.save\n                </button>\n              </div>\n            </div>\n            \x3c!-- File Block --\x3e\n            <bb-file-viewer\n              ng-if="::bbmlEditor.checkBlockType(authoringBlock, \'fileBlock\')"\n              file="authoringBlock.fileBlock"\n              delete-func="bbmlEditor.deleteBlock(authoringBlock.id)"\n              on-file-edit="bbmlEditor.onFileEdit(authoringBlock.id, file)"\n              block-id="::authoringBlock.id"\n              can-edit="!bbmlEditor.isAddFileInProgress() && !bbmlEditor.isEditing"\n              show-edit-button="bbmlEditor.showFileEditButton()"\n              show-delete-button="bbmlEditor.showFileDeleteButton()"\n              show-view-button="bbmlEditor.showFileViewButton()"\n              allow-reorder="true"\n              drag-start-handler="bbmlEditor.onStartDrag"\n              drag-stop-handler="bbmlEditor.onStopDrag"\n              root-content-id="{{::rootContentId}}"\n              ally-index="{{bbmlEditor.getAllyIndexForFile(authoringBlock.fileBlock)}}"\n            >\n            </bb-file-viewer>\n            \x3c!-- File Upload Progress --\x3e\n            <div id="{{\'#bbml-editor-\' + authoringBlock.id}}" class="file-details">\n              <bb-progress  primary-key="::bbmlEditor.bbmlEditorId"\n                            display-results="false"\n                            target-div="{{\'#bbml-editor\' + authoringBlock.id}}"></bb-progress>\n            </div>\n          </div>\n        </div>\n        <bb-add-content-button\n          always-show="bbmlEditor.shouldAlwaysShowAddContentButton"\n          show-both-buttons="true"\n          hide-divider-lines="false"\n          position-after="$index"\n          item-name="authoringBlock.fileBlock.linkName"\n          item-type="authoringBlock.textBlock ? \'text\' : \'\'"\n          item-index="$index + 1"\n          disable-drag="true"\n          attach-handler="attachHandler ? attachHandler: bbmlEditor.defaultCloudStorageIntegrationAttachHandler"\n          web-location="{{bbml().webLocation}}"\n          file-location="{{bbml().fileLocation}}"\n          primary-key="::bbmlEditor.bbmlEditorId"\n          ignored-states="::fileUploadInterruptIgnoreStates()"\n          context-area="\'bbml-editor\'"></bb-add-content-button>\n      </div>\n      <div class="bbml-editor-top-bar"\n           tabindex="-1"\n           bb-drop-handler\n           disable-for-reordering="true"\n           on-file-drop-handler="::bbmlEditor.onFileDropHandler">\n        <div class="element-list-row" bb-content-item-mouseover can-create="true">\n          \x3c!-- File Upload Progress --\x3e\n          <div id="progress-{{::bbmlEditor.targetDiv}}" class="file-details">\n            <bb-progress  primary-key="::bbmlEditor.bbmlEditorId"\n                          display-results="false"\n                          target-div="{{::bbmlEditor.targetDiv}}"></bb-progress>\n          </div>\n        </div>\n      </div>\n    </bb-file-upload>\n  </div>\n  <div class="hide"\n       bb-confirmation-needed="x-bb-save-and-close"\n       modal-name="document-without-saving"\n       show-type="always"\n       other-choice-action="bbmlEditor.closePanel()"\n       ng-click="bbmlEditor.saveAndClosePanel()"\n       analytics-id="components.directives.bbml-editor.saveAndClose"\n  ></div>\n  <bb-file-property-dialog\n    ng-if="!!bbmlEditor.uploadedFileReact"\n    analytics-id="document-editor"\n    hidden="!bbmlEditor.uploadedFileReact"\n    file="bbmlEditor.uploadedFileReact"\n    supports-inline-document-render="bbmlEditor.supportsInlineDocumentRender"\n    can-provide-description="true"\n    on-save="bbmlEditor.onUploadedFilePropertyDialogSave"\n    on-cancel="bbmlEditor.onUploadedFilePropertyDialogCancel"\n  ></bb-file-property-dialog>\n</div>\n'},"mb/O":function(e,t,i){"use strict";var n=i("Llzl"),o=i("ZzYr"),s=i("+4Px"),l=i("Gfig");i.d(t,"a",(function(){return a}));const a="ultra.components.directives.content.contentConversationToggle";class r{constructor(e,t){this.scope=e,this.element=t,this.isDisabled=!1,this.isStatic=!1,this.setupWatchers(),this.toggleElement=this.element.find("#allow-class-conversations-checkbox"),this.toggleElement.on("keydown",e=>{s.y(e)&&e.preventDefault()})}setupWatchers(){this.scope.$watch("isStatic()",e=>{n.isDefined(e)&&(this.isStatic=e)}),this.scope.$watch("isDisabled()",e=>{n.isDefined(e)&&(this.isDisabled=e)}),this.scope.$watch("content()",e=>{if(n.isDefined(e)){const t=e.hasConversation();this.content=e,this.content.allowConversations=t,this.content.ui.hasConversationAttached=t}})}isGradingColumnAnonymous(){const e=this.content&&this.content.getDeployedAssessment();return e&&e.gradingColumn&&e.gradingColumn.anonymousGrading}update(){this.content.ui.hasConversationAttached=this.content.allowConversations,this.onChange()}onChange(){this.scope.onchangeFunc&&this.scope.onchangeFunc()}onBlur(){this.scope.onblurFunc&&this.scope.onblurFunc()}}r.$inject=["scope","element"];class c{constructor(e,t){this.$injector=e,this.element=t,this.restrict="AE",this.template=l,this.scope={content:"&",isDisabled:"&",isStatic:"&",labelDetails:"<?",onblurFunc:"&?",onchangeFunc:"&?"},this.link=(e,t)=>{e.contentConversationToggle=this.$injector.instantiate(r,{scope:e,element:t})}}}c.$inject=["$injector"],n.module(a,[o.a]).directive("bbContentConversationToggle",["$injector",e=>e.instantiate(c)])},ph44:function(e,t,i){},uJ9h:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i("1ZbL"),o=i("kcGO");const s="ultra.components.services.contentProgressView",l={Class:o.ContentProgressView,attributes:["analyticsId"],bindingNames:["courseId","contentId","requiresManualMarking","isOrganization"],renderLocalized:!0,withProvider:!0};angular.module(s,[]).component("bbUiContentProgressView",Object(n.a)(l))},wmAO:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s}));const n={"application/msword":["doc","dot"],"application/pdf":["pdf"],"application/vnd.ms-excel":["xls","xlt","xla"],"application/vnd.ms-excel.addin.macroEnabled.12":["xlam"],"application/vnd.ms-excel.sheet.binary.macroEnabled.12":["xlsb"],"application/vnd.ms-excel.sheet.macroEnabled.12":["xlsm"],"application/vnd.ms-excel.template.macroEnabled.12":["xltm"],"application/vnd.ms-powerpoint":["ppt","pot","pps","ppa"],"application/vnd.ms-powerpoint.addin.macroEnabled.12":["ppam"],"application/vnd.ms-powerpoint.presentation.macroEnabled.12":["pptm","potm"],"application/vnd.ms-powerpoint.slideshow.macroEnabled.12":["ppsm"],"application/vnd.ms-word.document.macroEnabled.12":["docm"],"application/vnd.ms-word.template.macroEnabled.12":["dotm"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/vnd.openxmlformats-officedocument.presentationml.slideshow":["ppsx"],"application/vnd.openxmlformats-officedocument.presentationml.template":["potx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.template":["xltx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.template":["dotx"],"text/plain":["txt"]};function o(e,t){const i=t?`${e}/${t}`:e;return i in n?`.${n[i][0]}`:""}function s(e){const t=e.split(".");if(t.length>1){const e=t[t.length-1];for(const t in n)if(n[t].indexOf(e)>-1)return!0}return!1}}}]);